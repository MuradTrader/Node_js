## üéØ **–û–°–ù–û–í–ù–ê–Ø –¶–ï–õ–¨ –£–†–û–ö–ê**

–ê–≤—Ç–æ—Ä –æ–±—ä—è—Å–Ω—è–µ—Ç **—Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ –ø–æ–∏—Å–∫—É "–≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫"** –≤ –∫–æ–¥–µ, –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π.

## üèóÔ∏è **–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô –ü–†–ò–ù–¶–ò–ü: –†–ê–ó–î–ï–õ–ï–ù–ò–ï –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–ò**

### **–†–æ–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**

**Controllers** - —Ç–æ–ª—å–∫–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:

```typescript
// –¢–û–õ–¨–ö–û –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
@Controller("users")
export class UsersController {
  constructor(private readonly usersService: UsersService) {}

  @Post()
  createUser(@Body() createUserDto: CreateUserDto) {
    return this.usersService.createUser(createUserDto); // ‚Üê –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
  }
}
```

**Services** - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ò –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:

```typescript
// –í–°–Ø –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –í–°–ï –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∑–¥–µ—Å—å
@Injectable()
export class UsersService {
  async createUser(createUserDto: CreateUserDto) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∏, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –∏—Å–∫–ª—é—á–µ–Ω–∏—è...
    if (await this.userExists(createUserDto.email)) {
      throw new ConflictException("User already exists");
    }
    // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
  }
}
```

## üîç **3 –û–°–ù–û–í–ù–´–• "–ì–û–†–Ø–ß–ò–• –¢–û–ß–ö–ò" –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô**

### **1. –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•** üóÑÔ∏è

**–ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ:**

```typescript
// –í –≤–∞—à–µ–º –∫–æ–¥–µ –ï–°–¢–¨ —ç—Ç–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏:

// –í PostsService:
public async create(createPostDto: CreatePostDto) {
  // ‚ùå –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –µ—Å–ª–∏:
  // - authorId –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  // - tags –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
  // - –Ω–∞—Ä—É—à–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ë–î
}

// –í UsersService:
public async createUser(createUserDto: CreateUserDto) {
  // ‚ùå –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –µ—Å–ª–∏:
  // - –¥—É–±–ª–∏–∫–∞—Ç email
  // - –Ω–∞—Ä—É—à–µ–Ω–∏–µ constraints
}
```

**–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–∏—Å–∫–∏:**

- **–ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è** —Å –ë–î
- **–ù–∞—Ä—É—à–µ–Ω–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π** (constraints)
- **–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ foreign keys**
- **–û—à–∏–±–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏**

### **2. –ú–û–î–ï–õ–¨–ù–´–ï –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø (MODEL CONSTRAINTS)** ‚ö†Ô∏è

**–ü—Ä–∏–º–µ—Ä –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞:**

**User Entity –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—è:**

```typescript
@Entity()
export class User {
  @Column({
    type: "varchar",
    length: 96,
    nullable: false,
    unique: true, // ‚Üê –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò!
  })
  email: string;
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

```typescript
// –°—Ü–µ–Ω–∞—Ä–∏–π:
// 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email "john@doe.com" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
// 2. –ü—ã—Ç–∞–µ–º—Å—è —Å–æ–∑–¥–∞—Ç—å –≤—Ç–æ—Ä–æ–≥–æ —Å —Ç–µ–º –∂–µ email
// 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
// 4. NestJS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 Internal Server Error
// 5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –Ω–µ–ø–æ–Ω—è—Ç–Ω—É—é –æ—à–∏–±–∫—É
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**

```typescript
public async createUser(createUserDto: CreateUserDto) {
  // ‚úÖ –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê
  const existingUser = await this.usersRepository.findOne({
    where: { email: createUserDto.email }
  });

  if (existingUser) {
    throw new ConflictException('User with this email already exists');
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...
}
```

### **3. –í–ó–ê–ò–ú–û–î–ï–ô–°–¢–í–ò–ï –° –í–ù–ï–®–ù–ò–ú–ò API** üåê

**–ü—Ä–∏–º–µ—Ä –∏–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:**

```typescript
// –í UsersService —É–∂–µ –µ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ API:
private readonly profileConfiguration; // ‚Üê PROFILE_API_KEY

// –í –±—É–¥—É—â–µ–º –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è:
public async fetchUserProfile(userId: number) {
  // ‚ùå –†–∏—Å–∫–∏ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –≤–Ω–µ—à–Ω–µ–≥–æ API:
  // - –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
  // - –¢–∞–π–º–∞—É—Ç—ã
  // - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
  // - –ò–∑–º–µ–Ω–µ–Ω–∏–µ API
  // - –ö–≤–æ—Ç—ã –∏ –ª–∏–º–∏—Ç—ã
}
```

**–¢–∏–ø–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ—à–∏–±–æ–∫:**

- **–°–µ—Ç–µ–≤—ã–µ –ø—Ä–æ–±–ª–µ–º—ã** - API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –Ω–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á
- **–¢–∞–π–º–∞—É—Ç—ã** - API –æ—Ç–≤–µ—á–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ
- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞** - API –∏–∑–º–µ–Ω–∏–ª—Å—è

## üéØ **–ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ö –í–ê–®–ï–ú–£ –ö–û–î–£**

### **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç "–≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫":**

**1. UsersService.createUser() - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**

```typescript
public async createUser(createUserDto: CreateUserDto) {
  // –°–µ–π—á–∞—Å: –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  // –†–∏—Å–∫: –æ—à–∏–±–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email –æ—Ç –ë–î

  const existingUser = await this.usersRepository.findOne({
    where: { email: createUserDto.email }
  });
  // ‚ùå –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò!

  let newUser = this.usersRepository.create(createUserDto);
  newUser = await this.usersRepository.save(newUser); // ‚Üê –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å!
}
```

**2. PostsService.create() - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**

```typescript
public async create(createPostDto: CreatePostDto) {
  let author = await this.usersService.findOneById(createPostDto.authorId);
  // ‚ùå –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?

  let tags = await this.tagsService.findMultipleTags(createPostDto.tags);
  // ‚ùå –ß—Ç–æ –µ—Å–ª–∏ —Ç–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã?
}
```

**3. PostsService.delete() - –í–ê–ñ–ù–û:**

```typescript
public async delete(id: number) {
  await this.postsRepository.delete(id);
  // ‚ùå –ß—Ç–æ –µ—Å–ª–∏ –ø–æ—Å—Ç —Å —Ç–∞–∫–∏–º ID –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
  // –°–µ–π—á–∞—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç { deleted: true } –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —É–¥–∞–ª–∏–ª
}
```

## üß† **–ú–ï–ù–¢–ê–õ–¨–ù–ê–Ø –ú–û–î–ï–õ–¨ –î–õ–Ø –ü–û–ò–°–ö–ê –ü–†–û–ë–õ–ï–ú–ù–´–• –ú–ï–°–¢**

### **–í–æ–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å —Å–µ–±–µ:**

1. **"–ß—Ç–æ –µ—Å–ª–∏ —ç—Ç–æ—Ç –∑–∞–ø—Ä–æ—Å –∫ –ë–î –≤–µ—Ä–Ω–µ—Ç null/undefined?"**
2. **"–ß—Ç–æ –µ—Å–ª–∏ —ç—Ç–æ –ø–æ–ª–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º, –Ω–æ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?"**
3. **"–ß—Ç–æ –µ—Å–ª–∏ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω?"**
4. **"–ß—Ç–æ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ—à–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é?"**
5. **"–ß—Ç–æ –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é?"**

### **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞:**

**–í PostsService.update():**

```typescript
public async update(patchPostDto: PatchPostDto) {
  let post = await this.postsRepository.findOneBy({
    id: patchPostDto.id,
  });
  // ‚ùå –í–û–ü–†–û–°: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω?

  // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –∫–∞–∫ –±—É–¥—Ç–æ –ø–æ—Å—Ç —Å—É—â–µ—Å—Ç–≤—É–µ—Ç...
}
```

## üîß **–°–¢–†–ê–¢–ï–ì–ò–Ø –û–ë–†–ê–ë–û–¢–ö–ò –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô**

### **–£—Ä–æ–≤–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

**1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (Preemptive):**

```typescript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –î–û –æ–ø–µ—Ä–∞—Ü–∏–∏
if (!user) {
  throw new NotFoundException("User not found");
}
```

**2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ë–î (Reactive):**

```typescript
try {
  await this.usersRepository.save(user);
} catch (error) {
  if (error.code === "23505") {
    // –ö–æ–¥ –æ—à–∏–±–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ PostgreSQL
    throw new ConflictException("User already exists");
  }
  throw error; // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º –¥—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏
}
```

## üöÄ **–ü–û–î–ì–û–¢–û–í–ö–ê –ö –°–õ–ï–î–£–Æ–©–ò–ú –£–†–û–ö–ê–ú**

### **–ß—Ç–æ –∞–≤—Ç–æ—Ä –ø–ª–∞–Ω–∏—Ä—É–µ—Ç –ø–æ–∫–∞–∑–∞—Ç—å:**

1. **–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã** –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –≤–∞—à –∫–æ–¥
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö HTTP –∏—Å–∫–ª—é—á–µ–Ω–∏–π** (BadRequest, NotFound, Conflict)
3. **–û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ë–î** –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
4. **–£–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞** —á–µ—Ä–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –æ—à–∏–±–∫–∏

### **–ß—Ç–æ –≤–∞–º —Å—Ç–æ–∏—Ç —Å–¥–µ–ª–∞—Ç—å –º—ã—Å–ª–µ–Ω–Ω–æ:**

- **–ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–∞—à –∫–æ–¥** –∏ –æ—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –º–µ—Å—Ç–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ë–î
- **–í—ã—è–≤–∏—Ç—å –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ constraints** –≤ –≤–∞—à–∏—Ö entity
- **–ü–æ–¥—É–º–∞—Ç—å –æ –±—É–¥—É—â–∏—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è—Ö** —Å –≤–Ω–µ—à–Ω–∏–º–∏ API

## üí° **–ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´**

1. **–ò—Å–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö** - —Ç–∞–º –≥–¥–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
2. **–¢—Ä–∏ –≥–ª–∞–≤–Ω—ã–µ "–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏"**: –ë–î –æ–ø–µ—Ä–∞—Ü–∏–∏, –º–æ–¥–µ–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –≤–Ω–µ—à–Ω–∏–µ API
3. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏** –ª—É—á—à–µ —á–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è
4. **–î—É–º–∞–π—Ç–µ "—á—Ç–æ –µ—Å–ª–∏..."** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–≥–æ —É—á–∞—Å—Ç–∫–∞ –∫–æ–¥–∞

–ê–≤—Ç–æ—Ä –¥–∞–µ—Ç –≤–∞–º **—Å–∏—Å—Ç–µ–º–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –∫ –ø–æ–∏—Å–∫—É —É—è–∑–≤–∏–º—ã—Ö –º–µ—Å—Ç –≤ –∫–æ–¥–µ, –∞ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π! üéØ
