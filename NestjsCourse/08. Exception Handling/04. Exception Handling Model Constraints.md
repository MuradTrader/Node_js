## üéØ **–û–°–ù–û–í–ù–ê–Ø –¶–ï–õ–¨ –£–†–û–ö–ê**

–ê–≤—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –º–æ–¥–µ–ª–∏ (model constraints) –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ email –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## üîç **–ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ –í –í–ê–®–ï–ú –ö–û–î–ï**

### **–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è –≤ UsersService:**

**–§–∞–π–ª: `src/users/users.service.ts`**

```typescript
public async createUser(createUserDto: CreateUserDto) {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const existingUser = await this.usersRepository.findOne({
    where: { email: createUserDto.email },
  });

  /**
   * Handle exceptions if user exists later  // ‚ùå –ù–ï –û–ë–†–ê–ë–û–¢–ê–ù–û!
   * */

  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let newUser = this.usersRepository.create(createUserDto);
  newUser = await this.usersRepository.save(newUser); // ‚Üê –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å —Å –æ—à–∏–±–∫–æ–π —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏!

  return newUser;
}
```

### **–ü—Ä–æ–±–ª–µ–º–∞ –≤ User Entity:**

```typescript
@Entity()
export class User {
  @Column({
    type: "varchar",
    length: 96,
    nullable: false,
    unique: true, // ‚ö†Ô∏è –ë–ê–ó–ê –î–ê–ù–ù–´–• –í–´–ë–†–û–°–ò–¢ –û–®–ò–ë–ö–£ –ü–†–ò –î–£–ë–õ–ò–ö–ê–¢–ï
  })
  email: string;
}
```

## üîß **–®–ê–ì 1: –î–û–ë–ê–í–õ–ï–ù–ò–ï TRY-CATCH –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –û–®–ò–ë–û–ö –ë–ê–ó–´ –î–ê–ù–ù–´–•**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥ UsersService:**

```typescript
import { BadRequestException, RequestTimeoutException } from '@nestjs/common';

public async createUser(createUserDto: CreateUserDto) {
  let existingUser; // –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤–Ω–µ –±–ª–æ–∫–∞ try-catch

  try {
    // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    existingUser = await this.usersRepository.findOne({
      where: { email: createUserDto.email },
    });
  } catch (error) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
    throw new RequestTimeoutException(
      'Unable to process your request at the moment. Please try later.',
      { description: 'Error connecting to the database' }
    );
  }

  // –î–∞–ª—å–Ω–µ–π—à–∞—è –ª–æ–≥–∏–∫–∞...
}
```

## üîß **–®–ê–ì 2: –ü–†–û–í–ï–†–ö–ê –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò EMAIL**

### **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**

```typescript
public async createUser(createUserDto: CreateUserDto) {
  let existingUser;

  try {
    existingUser = await this.usersRepository.findOne({
      where: { email: createUserDto.email },
    });
  } catch (error) {
    throw new RequestTimeoutException(
      'Unable to process your request at the moment. Please try later.',
      { description: 'Error connecting to the database' }
    );
  }

  // ‚úÖ –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  if (existingUser) {
    throw new BadRequestException(
      'User already exists. Please check your email.'
    );
  }

  // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  let newUser = this.usersRepository.create(createUserDto);
  newUser = await this.usersRepository.save(newUser);

  return newUser;
}
```

## üîç **–î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–ó–ë–û–† –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô**

### **1. RequestTimeoutException - –¥–ª—è –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î**

```typescript
throw new RequestTimeoutException(
  "Unable to process your request at the moment. Please try later.", // –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  { description: "Error connecting to the database" } // –î–µ—Ç–∞–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
);
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- **HTTP —Å—Ç–∞—Ç—É—Å**: 408 Request Timeout
- **–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**: "Unable to process your request at the moment. Please try later."
- **–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏**: "Error connecting to the database"

### **2. BadRequestException - –¥–ª—è –¥—É–±–ª–∏–∫–∞—Ç–∞ email**

```typescript
throw new BadRequestException("User already exists. Please check your email.");
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- **HTTP —Å—Ç–∞—Ç—É—Å**: 400 Bad Request
- **–°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**: "User already exists. Please check your email."

## üéØ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ü–û–î–•–û–î–ê –ê–í–¢–û–†–ê**

### **1. –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ë–î:**

```typescript
// –†–ê–ù–¨–®–ï: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–∞–º–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
// –°–ï–ô–ß–ê–°: –ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –î–û –ø–æ–ø—ã—Ç–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
if (existingUser) {
  throw new BadRequestException("User already exists");
}
```

### **2. –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**

```typescript
// –í–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–∏ –ë–î:
"error: duplicate key value violates unique constraint";

// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:
"User already exists. Please check your email.";
```

### **3. –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã:**

```typescript
// –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
{
  "statusCode": 400,
  "message": "User already exists. Please check your email."
}
```

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –†–ê–ë–û–¢–´ –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô**

### **–¢–µ—Å—Ç 1: –î—É–±–ª–∏–∫–∞—Ç email**

**HTTP –∑–∞–ø—Ä–æ—Å:**

```http
POST http://localhost:3000/users
Content-Type: application/json

{
  "firstName": "John",
  "lastName": "Doe",
  "email": "john@doe.com",  // ‚Üê –£–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î
  "password": "Password123!"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```json
{
  "statusCode": 400,
  "message": "User already exists. Please check your email."
}
```

### **–¢–µ—Å—Ç 2: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞**

**–î–µ–π—Å—Ç–≤–∏—è:**

1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL —Å–µ—Ä–≤–µ—Ä
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```json
{
  "statusCode": 408,
  "message": "Unable to process your request at the moment. Please try later."
}
```

## üîß **–ü–†–û–î–í–ò–ù–£–¢–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò –û–ë–†–ê–ë–û–¢–ö–ò –û–®–ò–ë–û–ö**

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ (–¥–ª—è production):**

```typescript
} catch (error) {
  // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  console.error('Database connection error:', {
    message: error.message,
    stack: error.stack,
    timestamp: new Date().toISOString()
  });

  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  throw new RequestTimeoutException(
    'Unable to process your request at the moment. Please try later.',
    { description: 'Error connecting to the database' }
  );
}
```

### **–†–∞–∑–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ë–î:**

```typescript
} catch (error) {
  if (error.code === 'ECONNREFUSED') {
    throw new RequestTimeoutException('Database unavailable');
  } else if (error.code === 'ETIMEDOUT') {
    throw new RequestTimeoutException('Database timeout');
  } else {
    throw new InternalServerErrorException('Unexpected database error');
  }
}
```

## üí° **–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ï –ü–†–ê–ö–¢–ò–ö–ò –û–¢ –ê–í–¢–û–†–ê**

### **1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:**

```typescript
// –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ):
"Unable to process your request at the moment. Please try later.";

// –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ (–¥–µ—Ç–∞–ª–∏ –≤ description):
{
  description: "Error connecting to the database";
}
```

### **2. –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –æ—à–∏–±–æ–∫:**

```typescript
// –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è NestJS –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
// –õ–µ–≥–∫–æ –ø–∞—Ä—Å–∏—Ç—å –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
```

### **3. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö:**

```typescript
// –õ–£–ß–®–ï: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –î–û –æ–ø–µ—Ä–∞—Ü–∏–∏
if (existingUser) {
  throw new BadRequestException("User already exists");
}

// –•–£–ñ–ï: –î–æ–≤–µ—Ä–∏—Ç—å—Å—è –ë–î –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ—Å–ª–µ
```

## üö® **–ß–¢–û –ò–ó–ú–ï–ù–ò–õ–û–°–¨ –í –ü–û–í–ï–î–ï–ù–ò–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø**

### **–î–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí
–û—à–∏–±–∫–∞ –ë–î ‚Üí
NestJS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 Internal Server Error ‚Üí
–ù–µ–ø–æ–Ω—è—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```

### **–ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí
BadRequestException ‚Üí
NestJS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 400 Bad Request ‚Üí
–ü–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "User already exists"
```

## üîÆ **–ß–¢–û –î–ê–õ–¨–®–ï**

–ê–≤—Ç–æ—Ä –ø–æ–∫–∞–∑–∞–ª —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:

1. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** —É—Å–ª–æ–≤–∏–π –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** –∫ –≤–Ω–µ—à–Ω–∏–º —Ä–µ—Å—É—Ä—Å–∞–º
3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π** –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π** –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–í —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–∫–∞—Ö –±—É–¥–µ—Ç:**

- –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –º–æ–¥–µ–ª–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

–≠—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –¥–µ–ª–∞–µ—Ç –≤–∞—à–µ API –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–º –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-—Ñ—Ä–µ–Ω–¥–ª–∏! üöÄ
