## üéØ **–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å: "–ü–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–µ–∑–¥–µ?"**

### üîç **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞ PostsService**

–ê–≤—Ç–æ—Ä –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥ `create` –≤ `PostsService`:

```typescript
public async create(@Body() createPostDto: CreatePostDto) {
    // 1. –ù–∞—Ö–æ–¥–∏–º –∞–≤—Ç–æ—Ä–∞ - OPERATION 1 (–ß–¢–ï–ù–ò–ï)
    let author = await this.usersService.findOneById(createPostDto.authorId);

    // 2. –ù–∞—Ö–æ–¥–∏–º —Ç–µ–≥–∏ - OPERATION 2 (–ß–¢–ï–ù–ò–ï)
    let tags = await this.tagsService.findMultipleTags(createPostDto.tags);

    // 3. –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç - OPERATION 3 (–ó–ê–ü–ò–°–¨)
    let post = this.postsRepository.create({
        ...createPostDto,
        author: author,
        tags: tags,
    });

    // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å—Ç - OPERATION 4 (–ó–ê–ü–ò–°–¨)
    return await this.postsRepository.save(post);
}
```

## ‚ö° **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ–ø–µ—Ä–∞—Ü–∏–π**

### üìä **–†–∞–∑–±–∏–≤–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ —Ç–∏–ø–∞–º:**

| –û–ø–µ—Ä–∞—Ü–∏—è               | –¢–∏–ø    | –ò–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ? | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å |
| ---------------------- | ------ | ---------------- | ----------- |
| –ü–æ–∏—Å–∫ –∞–≤—Ç–æ—Ä–∞           | –ß—Ç–µ–Ω–∏–µ | ‚ùå –ù–µ—Ç           | –ù–∏–∑–∫–∞—è      |
| –ü–æ–∏—Å–∫ —Ç–µ–≥–æ–≤            | –ß—Ç–µ–Ω–∏–µ | ‚ùå –ù–µ—Ç           | –ù–∏–∑–∫–∞—è      |
| –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –ø–æ—Å—Ç–∞ | –õ–æ–≥–∏–∫–∞ | ‚ùå –ù–µ—Ç           | –°—Ä–µ–¥–Ω—è—è     |
| –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å—Ç–∞       | –ó–∞–ø–∏—Å—å | ‚úÖ –î–∞            | –í—ã—Å–æ–∫–∞—è     |

### üéØ **–ö–ª—é—á–µ–≤–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∞–≤—Ç–æ—Ä–∞:**

**"–≠—Ç–æ –≤—Å–µ–≥–æ –ª–∏—à—å –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö"**

–ê–≤—Ç–æ—Ä –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏ - `this.postsRepository.save(post)`.

## üîÑ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π createMany**

### üìà **–ê–Ω–∞–ª–∏–∑ –º–µ—Ç–æ–¥–∞ createMany:**

```typescript
public async createMany(createUsersDto: CreateUserDto[]) {
    // –ú–ù–û–ñ–ï–°–¢–í–û –û–ü–ï–†–ê–¶–ò–ô –ó–ê–ü–ò–°–ò
    for (const user of createUsersDto) {
        const newUser = queryRunner.manager.create(User, user);
        const result = await queryRunner.manager.save(newUser); // ‚Üê –û–ü–ï–†–ê–¶–ò–Ø –ó–ê–ü–ò–°–ò
        newUsers.push(result);
    }
}
```

**–ö–ª—é—á–µ–≤—ã–µ —Ä–∞–∑–ª–∏—á–∏—è:**

| –ê—Å–ø–µ–∫—Ç                       | create (Posts) | createMany (Users)      |
| ---------------------------- | -------------- | ----------------------- |
| **–û–ø–µ—Ä–∞—Ü–∏–π –∑–∞–ø–∏—Å–∏**          | 1              | –ú–Ω–æ–≥–æ (N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π) |
| **–¢–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞**             | 1              | –ú–Ω–æ–≥–æ (N —Ç–æ—á–µ–∫)         |
| **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ**     | –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ     | –í–æ–∑–º–æ–∂–Ω–æ                |
| **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** | ‚ùå –ù–µ—Ç         | ‚úÖ –î–∞                   |

## üö® **–ü—Ä–æ–±–ª–µ–º–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

### üí• **–°—Ü–µ–Ω–∞—Ä–∏–π –±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:**

```typescript
// –ë–ï–ó –¢–†–ê–ù–ó–ê–ö–¶–ò–ò - –û–ü–ê–°–ù–û!
for (const user of createUsersDto) {
  try {
    await this.usersRepository.save(user);
  } catch (error) {
    // –û—à–∏–±–∫–∞ –Ω–∞ 4-–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ...
    // –ù–æ –ø–µ—Ä–≤—ã–µ 3 —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ–∑–¥–∞–Ω—ã, 7 –Ω–µ —Å–æ–∑–¥–∞–Ω—ã ‚Üí **—Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

### ‚úÖ **–°—Ü–µ–Ω–∞—Ä–∏–π —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π:**

```typescript
// –° –¢–†–ê–ù–ó–ê–ö–¶–ò–ï–ô - –ë–ï–ó–û–ü–ê–°–ù–û
try {
  for (const user of createUsersDto) {
    await queryRunner.manager.save(user);
  }
  await queryRunner.commitTransaction(); // ‚úÖ –í–°–ï –ò–õ–ò –ù–ò–ß–ï–ì–û
} catch (error) {
  await queryRunner.rollbackTransaction(); // ‚ùå –û–¢–ú–ï–ù–ê –í–°–ï–• –ò–ó–ú–ï–ù–ï–ù–ò–ô
}
```

## üéØ **–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π**

### ‚úÖ **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–≥–¥–∞:**

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏** - –Ω–µ—Å–∫–æ–ª—å–∫–æ INSERT/UPDATE/DELETE
2. **–í–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π
3. **–ë–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ "–≤—Å–µ –∏–ª–∏ –Ω–∏—á–µ–≥–æ"** - –∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞
4. **–°–ª–æ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—Ü/—Å—É—â–Ω–æ—Å—Ç–µ–π

### ‚ùå **–ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–æ–≥–¥–∞:**

1. **–û–¥–∏–Ω–æ—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –æ–¥–∏–Ω INSERT/UPDATE/DELETE
2. **–û–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è** - SELECT –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ
3. **–ü—Ä–æ—Å—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** - –Ω–µ—Ç —Ä–∏—Å–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞** - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç overhead

## ‚ö° **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**

### üîß **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, overhead —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- **–û–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –º–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤

### üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:**

- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –≥–∞—Ä–∞–Ω—Ç–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- **–û–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –ø—Ä–æ—â–µ, –Ω–æ —Ä–∏—Å–∫ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üìù **–°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞:**

- **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - —Å–ª–æ–∂–Ω–µ–µ (try/catch/finally, commit/rollback)
- **–û–±—ã—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –ø—Ä–æ—â–µ (–ø—Ä—è–º–æ–ª–∏–Ω–µ–π–Ω—ã–π –∫–æ–¥)

## üéØ **–í—ã–≤–æ–¥ –∞–≤—Ç–æ—Ä–∞:**

**"–í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤–µ–∑–¥–µ - –æ–Ω–∏ —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –æ–Ω–∏ –Ω—É–∂–Ω—ã"**

–≠—Ç–æ –ø—Ä–∏–Ω—Ü–∏–ø "–∑–æ–ª–æ—Ç–æ–π —Å–µ—Ä–µ–¥–∏–Ω—ã" –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –∏—Ö –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–µ—à–∏–≤–∞—é—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ - —ç—Ç–æ –Ω–µ "—Å–µ—Ä–µ–±—Ä—è–Ω–∞—è –ø—É–ª—è", –∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤! üîß
