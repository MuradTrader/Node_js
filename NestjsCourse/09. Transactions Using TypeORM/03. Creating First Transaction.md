## üéØ **–°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ createMany**

### üìù **–û–±—ä—è–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞**

```typescript
public async createMany(createUsersDto: CreateUserDto[]) {
```

**–ß—Ç–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

- `public` - –º–µ—Ç–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–ª–∞—Å—Å–æ–≤
- `async` - –º–µ—Ç–æ–¥ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç Promise
- `createUsersDto: CreateUserDto[]` - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –º–∞—Å—Å–∏–≤ DTO –æ–±—ä–µ–∫—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:**

```typescript
// –¢–ê–ö –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è!
createUsersDto: CreateUserDto[]
```

–ê–≤—Ç–æ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–º–µ—á–∞–µ—Ç, —á—Ç–æ NestJS –Ω–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```typescript
@ValidateNested({ each: true })
createUsersDto: CreateUserDto[]
```

–ù–æ —ç—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–∑–∂–µ.

## üîß **–í–Ω–µ–¥—Ä–µ–Ω–∏–µ DataSource**

### üíâ **Dependency Injection –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ**

```typescript
constructor(
    @InjectRepository(User)
    private usersRepository: Repository<User>,

    // –í–ù–ï–î–†–ï–ù–ò–ï DATA SOURCE
    private readonly dataSource: DataSource
) {}
```

**DataSource - —á—Ç–æ —ç—Ç–æ –∏ –∑–∞—á–µ–º:**

- `DataSource` - –∫–æ—Ä–Ω–µ–≤–æ–π –æ–±—ä–µ–∫—Ç TypeORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏–∑ `app.module.ts`
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—É–ª–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å QueryRunner –¥–ª—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

**–ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ:**

- NestJS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º
- `private readonly` - –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è + –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
- –î–æ—Å—Ç—É–ø–µ–Ω –≤–æ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–∞—Ö –∫–ª–∞—Å—Å–∞

## üèÉ **–°–æ–∑–¥–∞–Ω–∏–µ QueryRunner**

### üîÑ **–®–∞–≥–∏ —Ä–∞–±–æ—Ç—ã —Å QueryRunner**

```typescript
const queryRunner = this.dataSource.createQueryRunner();
await queryRunner.connect();
await queryRunner.startTransaction();
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ:**

1. **`createQueryRunner()`**

   ```typescript
   // TypeORM —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä QueryRunner
   // –ù–û —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
   const queryRunner = this.dataSource.createQueryRunner();
   ```

2. **`queryRunner.connect()`**

   ```typescript
   // –ü–æ–ª—É—á–∞–µ—Ç –û–î–ù–û —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∏–∑ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   // –ü—É–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ app.module.ts (max connections)
   await queryRunner.connect();
   ```

3. **`queryRunner.startTransaction()`**
   ```typescript
   // –ù–∞—á–∏–Ω–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é
   // –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ - —á–∞—Å—Ç—å –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   await queryRunner.startTransaction();
   ```

## üõ°Ô∏è **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ try-catch-finally**

### üìã **–ó–∞—á–µ–º —Ç–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

```typescript
try {
  // –£–°–ü–ï–®–ù–û–ï –í–´–ü–û–õ–ù–ï–ù–ò–ï
} catch (error) {
  // –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö
} finally {
  // –í–°–ï–ì–î–ê –í–´–ü–û–õ–ù–Ø–ï–¢–°–Ø
}
```

**–õ–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ù–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   –ë–ª–æ–∫ TRY      ‚îÇ ‚Üê‚îÄ‚îÄ –ü–æ–ø—ã—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ           ‚îÇ
    ‚ñº           ‚ñº
–£—Å–ø–µ—Ö       –û—à–∏–±–∫–∞
    ‚îÇ           ‚îÇ
    ‚ñº           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ COMMIT  ‚îÇ ‚îÇ ROLLBACK‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ           ‚îÇ
         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚ñº
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ   FINALLY   ‚îÇ ‚Üê‚îÄ‚îÄ –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
        ‚îÇ  RELEASE()  ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üë• **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —Ü–∏–∫–ª–µ**

### üîÑ **–î–µ—Ç–∞–ª–∏ —Ü–∏–∫–ª–∞ for...of**

```typescript
let newUsers: User[] = [];

for (const user of createUsersDto) {
  const newUser = queryRunner.manager.create(User, user);
  const result = await queryRunner.manager.save(newUser);
  newUsers.push(result);
}
```

**–†–∞–∑–±–µ—Ä–µ–º –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ–∫—É:**

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞:**

   ```typescript
   let newUsers: User[] = [];
   // User[] - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è, —Ç–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã User
   // [] - –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   ```

2. **–¶–∏–∫–ª for...of:**

   ```typescript
   for (const user of createUsersDto) {
   // for...of - –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –∑–Ω–∞—á–µ–Ω–∏—è–º –º–∞—Å—Å–∏–≤–∞
   // const user - –∫–∞–∂–¥–∞—è DTO –≤ –º–∞—Å—Å–∏–≤–µ
   // createUsersDto - –º–∞—Å—Å–∏–≤ –≤—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   ```

3. **–°–æ–∑–¥–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏:**

   ```typescript
   const newUser = queryRunner.manager.create(User, user);
   // queryRunner.manager - EntityManager —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   // create(User, user) - —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä User
   // –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î, —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç!
   ```

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î:**

   ```typescript
   const result = await queryRunner.manager.save(newUser);
   // save() - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   // await - –∂–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
   // result - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å ID –∏ —Ç.–¥.
   ```

5. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
   ```typescript
   newUsers.push(result);
   // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∂–¥–æ–≥–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   // –î–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ –º–µ—Ç–æ–¥–∞
   ```

## ‚ö° **Manager vs Repository - –≥–ª—É–±–æ–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ**

### üÜö **–í —á–µ–º —Ä–∞–∑–Ω–∏—Ü–∞**

```typescript
// –û–ë–´–ß–ù–´–ô –°–ü–û–°–û–ë (–±–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
const newUser = this.usersRepository.create(user);
const result = await this.usersRepository.save(newUser);

// –¢–†–ê–ù–ó–ê–ö–¶–ò–û–ù–ù–´–ô –°–ü–û–°–û–ë
const newUser = queryRunner.manager.create(User, user);
const result = await queryRunner.manager.save(newUser);
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è:**

| –ê—Å–ø–µ–∫—Ç         | Repository    | QueryRunner.manager        |
| -------------- | ------------- | -------------------------- |
| **–ö–æ–Ω—Ç–µ–∫—Å—Ç**   | –ì–ª–æ–±–∞–ª—å–Ω—ã–π    | –í —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏        |
| **–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** | –õ—é–±–æ–µ –∏–∑ –ø—É–ª–∞ | –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–¥–Ω–æ         |
| **–ò–∑–æ–ª—è—Ü–∏—è**   | –ù–µ—Ç           | –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ |
| **–û—Ç–∫–∞—Ç**      | –ù–µ–≤–æ–∑–º–æ–∂–µ–Ω    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç       |

## üõ°Ô∏è **–ì–∞—Ä–∞–Ω—Ç–∏–∏ ACID –≤ –¥–µ–π—Å—Ç–≤–∏–∏**

### üîÑ **Commit vs Rollback**

**–£—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**

```typescript
try {
    // –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —É—Å–ø–µ—à–Ω—ã
    await queryRunner.commitTransaction();
    // ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
    // ‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
    // ‚úÖ –î–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã –¥—Ä—É–≥–∏–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º
}
```

**–°—Ü–µ–Ω–∞—Ä–∏–π —Å –æ—à–∏–±–∫–æ–π:**

```typescript
catch (error) {
    // –û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å
    await queryRunner.rollbackTransaction();
    // ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω–µ–Ω—ã
    // ‚úÖ –ë–∞–∑–∞ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
    // ‚ùå –ù–∏ –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å–æ–∑–¥–∞–Ω
}
```

## üîÑ **–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è - –ö–†–ò–¢–ò–ß–ï–°–ö–ò –≤–∞–∂–Ω—ã–π —à–∞–≥**

### üí• **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ release()**

```typescript
// –ë–ï–ó FINALLY - –û–ü–ê–°–ù–û!
try {
  // –æ–ø–µ—Ä–∞—Ü–∏–∏...
} catch (error) {
  await queryRunner.rollbackTransaction();
  // –°–û–ï–î–ò–ù–ï–ù–ò–ï –ù–ï –û–°–í–û–ë–û–ñ–î–ï–ù–û!
  // –£–¢–ï–ß–ö–ê –ü–ê–ú–Ø–¢–ò!
}
```

**–ü–æ—á–µ–º—É finally –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**

```typescript
finally {
    await queryRunner.release();
    // ‚úÖ –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
    // ‚úÖ –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—É–ª
    // ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —É—Ç–µ—á–∫–∏
    // ‚úÖ –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –ë–î
}
```

## üéØ **–ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏**

**–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞:**

```
DataSource ‚Üí QueryRunner ‚Üí Connect ‚Üí StartTransaction
    ‚Üì
    TRY: Operations ‚Üí Commit
    CATCH: Rollback
    FINALLY: Release
    ‚Üì
–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–æ –≤ –ø—É–ª ‚úÖ
```

# –ò—Ç–æ–≥–æ–≤—ã–π –∫–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ UsersService

## üéØ **–ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å–µ—Ä–≤–∏—Å–∞ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π**

### `src/users/providers/users.service.ts`

```typescript
import { Repository } from "typeorm";
import { GetUsersParamDto } from "../dtos/get-users-param.dto";
import {
  BadRequestException,
  HttpException,
  HttpStatus,
  Inject,
  Injectable,
  RequestTimeoutException,
} from "@nestjs/common";
import { User } from "../user.entity";
import { InjectRepository } from "@nestjs/typeorm";
import { CreateUserDto } from "../dtos/create-user.dto";
import { ConfigService, ConfigType } from "@nestjs/config";
import profileConfig from "../config/profile.config";
// –ò–ú–ü–û–†–¢ DATA SOURCE –î–õ–Ø –¢–†–ê–ù–ó–ê–ö–¶–ò–ô
import { DataSource } from "typeorm";

/**
 * Controller class for '/users' API endpoint
 */
@Injectable()
export class UsersService {
  constructor(
    /**
     * Injecting usersRepository
     */
    @InjectRepository(User)
    private usersRepository: Repository<User>,

    @Inject(profileConfig.KEY)
    private readonly profileConfiguration: ConfigType<typeof profileConfig>,

    // ‚úÖ –í–ù–ï–î–†–ï–ù–ò–ï DATA SOURCE –î–õ–Ø –†–ê–ë–û–¢–´ –° –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø–ú–ò
    private readonly dataSource: DataSource
  ) {}

  /**
   * –ú–ï–¢–û–î –î–õ–Ø –ú–ê–°–°–û–í–û–ì–û –°–û–ó–î–ê–ù–ò–Ø –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –ß–ï–†–ï–ó –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
   */
  public async createMany(createUsersDto: CreateUserDto[]) {
    // 1. –°–û–ó–î–ê–ï–ú QUERY RUNNER
    const queryRunner = this.dataSource.createQueryRunner();

    // 2. –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –°–û–ï–î–ò–ù–ï–ù–ò–ï –° –ë–ê–ó–û–ô –î–ê–ù–ù–´–•
    await queryRunner.connect();

    // 3. –ù–ê–ß–ò–ù–ê–ï–ú –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
    await queryRunner.startTransaction();

    // –ú–ê–°–°–ò–í –î–õ–Ø –•–†–ê–ù–ï–ù–ò–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í
    let newUsers: User[] = [];

    try {
      // 4. –í–´–ü–û–õ–ù–Ø–ï–ú –û–ü–ï–†–ê–¶–ò–ò –í –¢–†–ê–ù–ó–ê–ö–¶–ò–ò
      for (const user of createUsersDto) {
        // –°–û–ó–î–ê–ï–ú –°–£–©–ù–û–°–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø
        const newUser = queryRunner.manager.create(User, user);

        // –°–û–•–†–ê–ù–Ø–ï–ú –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø –í –ë–ê–ó–£ –î–ê–ù–ù–´–•
        const result = await queryRunner.manager.save(newUser);

        // –î–û–ë–ê–í–õ–Ø–ï–ú –†–ï–ó–£–õ–¨–¢–ê–¢ –í –ú–ê–°–°–ò–í
        newUsers.push(result);
      }

      // 5. –ï–°–õ–ò –í–°–ï –û–ü–ï–†–ê–¶–ò–ò –£–°–ü–ï–®–ù–´ - –ö–û–ú–ú–ò–¢–ò–ú –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
      await queryRunner.commitTransaction();

      // –í–û–ó–í–†–ê–©–ê–ï–ú –°–û–ó–î–ê–ù–ù–´–• –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
      return newUsers;
    } catch (error) {
      // 6. –ï–°–õ–ò –í–û–ó–ù–ò–ö–õ–ê –û–®–ò–ë–ö–ê - –û–¢–ö–ê–¢–´–í–ê–ï–ú –¢–†–ê–ù–ó–ê–ö–¶–ò–Æ
      await queryRunner.rollbackTransaction();

      // –ü–†–û–ë–†–ê–°–´–í–ê–ï–ú –û–®–ò–ë–ö–£ –î–ê–õ–¨–®–ï
      throw error;
    } finally {
      // 7. –í–°–ï–ì–î–ê –û–°–í–û–ë–û–ñ–î–ê–ï–ú –°–û–ï–î–ò–ù–ï–ù–ò–ï
      await queryRunner.release();
    }
  }

  // ‚¨áÔ∏è –°–£–©–ï–°–¢–í–£–Æ–©–ò–ï –ú–ï–¢–û–î–´ –û–°–¢–ê–Æ–¢–°–Ø –ë–ï–ó –ò–ó–ú–ï–ù–ï–ù–ò–ô ‚¨áÔ∏è

  public async createUser(createUserDto: CreateUserDto) {
    let existingUser = undefined;

    try {
      // Check is user exists with same email
      existingUser = await this.usersRepository.findOne({
        where: { email: createUserDto.email },
      });
    } catch (error) {
      // Might save the details of the exception
      // Information which is sensitive
      throw new RequestTimeoutException(
        "Unable to process your request at the moment please try later",
        {
          description: "Error connecting to the database",
        }
      );
    }

    // Handle exception
    if (existingUser) {
      throw new BadRequestException(
        "The user already exists, please check your email."
      );
    }

    // Create a new user
    let newUser = this.usersRepository.create(createUserDto);

    try {
      newUser = await this.usersRepository.save(newUser);
    } catch (error) {
      throw new RequestTimeoutException(
        "Unable to process your request at the moment please try later",
        {
          description: "Error connecting to the the datbase",
        }
      );
    }

    return newUser;
  }

  /**
   * Public method responsible for handling GET request for '/users' endpoint
   */
  public findAll(
    getUserParamDto: GetUsersParamDto,
    limit: number,
    page: number
  ) {
    throw new HttpException(
      {
        status: HttpStatus.MOVED_PERMANENTLY,
        error: "The API endpoint does not exist",
        fileName: "users.service.ts",
        lineNumber: 88,
      },
      HttpStatus.MOVED_PERMANENTLY,
      {
        cause: new Error(),
        description: "Occured because the API endpoint was permanently moved",
      }
    );
  }

  /**
   * Public method used to find one user using the ID of the user
   */
  public async findOneById(id: number) {
    let user = undefined;

    try {
      user = await this.usersRepository.findOneBy({
        id,
      });
    } catch (error) {
      throw new RequestTimeoutException(
        "Unable to process your request at the moment please try later",
        {
          description: "Error connecting to the the datbase",
        }
      );
    }

    /**
     * Handle the user does not exist
     */
    if (!user) {
      throw new BadRequestException("The user id does not exist");
    }

    return user;
  }
}
```
