## üéØ **–û–°–ù–û–í–ù–ê–Ø –¶–ï–õ–¨ –£–†–û–ö–ê**

–ê–≤—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ .env —Ñ–∞–π–ª—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è** (development, test, production).

## üîß **–®–ê–ì 1: –£–°–¢–ê–ù–û–í–ö–ê NODE_ENV –î–õ–Ø –†–ê–ó–†–ê–ë–û–¢–ö–ò**

### **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ package.json**

**–ë—ã–ª–æ:**

```json
"scripts": {
  "start:dev": "nest start --watch"
}
```

**–°—Ç–∞–ª–æ:**

```json
"scripts": {
  "start:dev": "NODE_ENV=development nest start --watch"
}
```

**–ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:**

- `NODE_ENV=development` - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ `process.env.NODE_ENV = 'development'`
- –ü—Ä–∏ —Ç–µ—Å—Ç–∞—Ö `process.env.NODE_ENV = 'test'` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç Jest)

## üìÅ **–®–ê–ì 2: –°–û–ó–î–ê–ù–ò–ï –†–ê–ó–ù–´–• .ENV –§–ê–ô–õ–û–í**

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤:**

```
project/
‚îú‚îÄ‚îÄ .env                 # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ NODE_ENV –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
‚îú‚îÄ‚îÄ .env.development     # –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .env.test           # –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ .env.production     # –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–±—É–¥–µ—Ç –ø–æ–∑–∂–µ)
```

### **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤:**

**.env.development:**

```env
S3_BUCKET=from development
```

**.env.test:**

```env
S3_BUCKET=from test
```

## ‚öôÔ∏è **–®–ê–ì 3: –ù–ê–°–¢–†–û–ô–ö–ê CONFIGMODULE –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ô –ó–ê–ì–†–£–ó–ö–ò –§–ê–ô–õ–û–í**

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ app.module.ts**

**–°—Ç–∞—Ä–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å):**

```typescript
ConfigModule.forRoot({
  isGlobal: true,
  envFilePath: ".env", // ‚ùå –í—Å–µ–≥–¥–∞ –æ–¥–∏–Ω —Ñ–∞–π–ª
});
```

**–ù–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø—É—Ç—å):**

```typescript
// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é —Å—Ä–µ–¥—É
const env = process.env.NODE_ENV;

ConfigModule.forRoot({
  isGlobal: true,
  envFilePath: env ? `.env.${env}` : ".env",
  // ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–∞–π–ª
});
```

### **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```typescript
// –õ–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞:
if (NODE_ENV === 'development') ‚Üí .env.development
if (NODE_ENV === 'test')       ‚Üí .env.test
if (NODE_ENV === 'production') ‚Üí .env.production
if (NODE_ENV –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)    ‚Üí .env
```

## üß™ **–®–ê–ì 4: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –†–ê–ë–û–¢–´**

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Development —Å—Ä–µ–¥—ã:**

**–ó–∞–ø—É—Å–∫:**

```bash
npm run start:dev  # NODE_ENV=development
```

**HTTP –∑–∞–ø—Ä–æ—Å:**

```http
GET http://localhost:3000/users/
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏:**

```
from development  # –ò–∑ .env.development
```

### **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Test —Å—Ä–µ–¥—ã:**

**–ó–∞–ø—É—Å–∫:**

```bash
npm run test:e2e  # NODE_ENV=test (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

**–í app.e2e-spec.ts:**

```typescript
// –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É S3_BUCKET
console.log(process.env.S3_BUCKET); // –í—ã–≤–µ–¥–µ—Ç: "from test"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∫–æ–Ω—Å–æ–ª–∏ —Ç–µ—Å—Ç–æ–≤:**

```
from test  # –ò–∑ .env.test
```

## üîÑ **–®–ê–ì 5: –ü–†–û–í–ï–†–ö–ê –¶–ï–ü–û–ß–ö–ò –†–ê–ë–û–¢–´**

### **–ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å:**

1. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** ‚Üí –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è NODE_ENV
2. **ConfigModule.forRoot()** ‚Üí –ß–∏—Ç–∞–µ—Ç NODE_ENV
3. **–í—ã–±–æ—Ä .env —Ñ–∞–π–ª–∞** ‚Üí –ù–∞ –æ—Å–Ω–æ–≤–µ NODE_ENV
4. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö** ‚Üí –í ConfigService
5. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö** ‚Üí –ß–µ—Ä–µ–∑ this.configService.get()

### **–í –≤–∞—à–µ–º UsersService:**

```typescript
public findAll() {
  const s3Bucket = this.configService.get<string>('S3_BUCKET');
  console.log(s3Bucket); // "from development" –∏–ª–∏ "from test"
  // ...
}
```

## üéØ **–ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –í –í–ê–®–ï–ú –ü–†–û–ï–ö–¢–ï**

### **–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

**1. –û–±–Ω–æ–≤–∏—Ç—å package.json:**

```json
"scripts": {
  "start:dev": "NODE_ENV=development nest start --watch",
  "start:debug": "NODE_ENV=development nest start --debug --watch",
  "start:prod": "NODE_ENV=production node dist/main"
}
```

**2. –û–±–Ω–æ–≤–∏—Ç—å app.module.ts:**

```typescript
const env = process.env.NODE_ENV;

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      envFilePath: env ? `.env.${env}` : ".env",
    }),
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
  ],
  // ...
})
export class AppModule {}
```

**3. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

- `.env.development` - –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `.env.test` - –¥–ª—è —Ç–µ—Å—Ç–æ–≤
- `.env.production` - –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–ø–æ–∑–∂–µ)

## üí° **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –≠–¢–û–ì–û –ü–û–î–•–û–î–ê**

### **1. –†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î:**

```env
# .env.development
DB_HOST=localhost
DB_PASSWORD=dev_password

# .env.test
DB_HOST=test-db
DB_PASSWORD=test_password

# .env.production
DB_HOST=production-db
DB_PASSWORD=prod_secret_password
```

### **2. –†–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ API:**

```env
# .env.development - —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏
STRIPE_KEY=pk_test_...
SENDGRID_KEY=SG.test...

# .env.production - —Ä–∞–±–æ—á–∏–µ –∫–ª—é—á–∏
STRIPE_KEY=pk_live_...
SENDGRID_KEY=SG.prod...
```

### **3. –†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

```env
# .env.development - –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —Ä–µ–∂–∏–º
DEBUG=true
LOG_LEVEL=debug

# .env.production - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
DEBUG=false
LOG_LEVEL=warn
```

## üö® **–í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´**

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**

- `.env.production` –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git
- –î–æ–±–∞–≤–∏—Ç—å –≤ `.gitignore`:
  ```
  .env.*
  !.env.example
  ```

### **–ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:**

```typescript
// ConfigModule –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ .env.${NODE_ENV}? ‚Üí –ó–∞–≥—Ä—É–∂–∞–µ—Ç –µ–≥–æ
2. –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –ó–∞–≥—Ä—É–∂–∞–µ—Ç .env
3. –ï—Å–ª–∏ .env –Ω–µ—Ç ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç process.env
```

## üîÆ **–ß–¢–û –î–ê–õ–¨–®–ï**

–ê–≤—Ç–æ—Ä –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª —Å–∏—Å—Ç–µ–º—É –¥–ª—è:

- ‚úÖ –†–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ .env —Ñ–∞–π–ª–∞
- ‚úÖ –õ–µ–≥–∫–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

**–í —Å–ª–µ–¥—É—é—â–∏—Ö —É—Ä–æ–∫–∞—Ö –±—É–¥–µ—Ç:**

- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö config —Å–µ—Ä–≤–∏—Å–æ–≤
- –†–∞–±–æ—Ç–∞ —Å TypeORM –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ environment variables

–≠—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –≤ NestJS! üöÄ
