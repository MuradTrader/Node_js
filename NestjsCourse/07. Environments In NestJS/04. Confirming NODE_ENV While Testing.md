## üéØ **–û–°–ù–û–í–ù–ê–Ø –¶–ï–õ–¨ –£–†–û–ö–ê**

–ê–≤—Ç–æ—Ä –æ–±—ä—è—Å–Ω—è–µ—Ç **–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ environment files –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥** –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫ Jest –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `NODE_ENV=test` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤.

## üîß **–ù–ê–°–¢–†–û–ô–ö–ê JEST –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø**

### **1. –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–æ–≤**

**–§–∞–π–ª—ã —Ç–µ—Å—Ç–æ–≤ –≤ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ:**

```
project/
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ jest-e2e.json          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è e2e —Ç–µ—Å—Ç–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ app.e2e-spec.ts        # –§–∞–π–ª e2e —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ package.json               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è unit —Ç–µ—Å—Ç–æ–≤
‚îî‚îÄ‚îÄ src/                       # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
```

### **2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—É—Ç—è–º–∏ –≤ Jest**

**–ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ (—á—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**

```json
// test/jest-e2e.json (–ë–´–õ–û)
{
  "rootDir": "test" // ‚ùå Jest –∏—â–µ—Ç –º–æ–¥—É–ª–∏ —Ç–æ–ª—å–∫–æ –≤ –ø–∞–ø–∫–µ test
}
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (—á—Ç–æ —Å–¥–µ–ª–∞–ª –∞–≤—Ç–æ—Ä):**

```json
// test/jest-e2e.json (–°–¢–ê–õ–û)
{
  "rootDir": "../", // ‚úÖ –¢–µ–ø–µ—Ä—å Jest —Å–º–æ—Ç—Ä–∏—Ç –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
  "modulePaths": ["<rootDir>"] // ‚úÖ –£–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç–∏ –∫ –º–æ–¥—É–ª—è–º
}
```

### **3. –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ `<rootDir>`**

**–ß—Ç–æ —Ç–∞–∫–æ–µ `<rootDir>`:**

- –≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è Jest
- –£–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤ `rootDir`)
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏

**–ü—Ä–∏–º–µ—Ä:**

```json
{
  "rootDir": "../",
  "modulePaths": ["<rootDir>"], // ‚Üí –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
  "moduleDirectories": ["<rootDir>/node_modules"] // ‚Üí node_modules –≤ –∫–æ—Ä–Ω–µ
}
```

### **4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ package.json –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤**

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ package.json:**

```json
// package.json (–±—ã–ª–æ)
"jest": {
  "rootDir": "src"  // ‚ùå –¢–æ–ª—å–∫–æ –ø–∞–ø–∫–∞ src
}

// package.json (—Å—Ç–∞–ª–æ)
"jest": {
  "rootDir": "./",        // ‚úÖ –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
  "modulePaths": ["<rootDir>"]  // ‚úÖ –ü—É—Ç–∏ –∫ –º–æ–¥—É–ª—è–º
}
```

## üß™ **–¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï NODE_ENV –ü–ï–†–ï–ú–ï–ù–ù–û–ô**

### **1. –ß—Ç–æ —Ç–∞–∫–æ–µ NODE_ENV**

**NODE_ENV** - —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Node.js, –∫–æ—Ç–æ—Ä–∞—è –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â—É—é —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

- `development` - —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- `test` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- `production` - –ø—Ä–æ–¥–∞–∫—à–Ω

### **2. –ö–∞–∫ Jest —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç NODE_ENV**

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ Jest:**

```javascript
// –ö–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ: npm run test:e2e

// Jest –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–ª–∞–µ—Ç:
process.env.NODE_ENV = "test";
```

### **3. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ app.e2e-spec.ts**

**–ö–æ–¥ —Ç–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø–∏—Å–∞–ª –∞–≤—Ç–æ—Ä:**

```typescript
// test/app.e2e-spec.ts
describe("AppController (e2e)", () => {
  it("/ (GET)", () => {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º NODE_ENV
    console.log(process.env.NODE_ENV); // –í—ã–≤–µ–¥–µ—Ç: 'test'

    // –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404
    return request(app.getHttpServer()).get("/non-existent-route").expect(404);
  });
});
```

### **4. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤**

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è e2e —Ç–µ—Å—Ç–æ–≤:**

```bash
npm run test:e2e
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏:**

1. Jest —á–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ `test/jest-e2e.json`
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `NODE_ENV = 'test'`
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –∏–∑ `app.e2e-spec.ts`
4. –í –∫–æ–Ω—Å–æ–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –≤—ã–≤–æ–¥ `test`

## üéØ **–ü–†–ê–ö–¢–ò–ß–ï–°–ö–û–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –í –í–ê–®–ï–ú –ü–†–û–ï–ö–¢–ï**

### **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–∏—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:**

**test/jest-e2e.json:**

```json
{
  "moduleFileExtensions": ["js", "json", "ts"],
  "rootDir": ".",
  "testEnvironment": "node",
  "testRegex": ".e2e-spec.ts$",
  "transform": {
    "^.+\\.(t|j)s$": "ts-jest"
  }
}
```

**package.json (—Å–µ–∫—Ü–∏—è jest):**

```json
"jest": {
  "moduleFileExtensions": ["js", "json", "ts"],
  "rootDir": "src",
  "testRegex": ".*\\.spec\\.ts$",
  "transform": {
    "^.+\\.(t|j)s$": "ts-jest"
  },
  "collectCoverageFrom": ["**/*.(t|j)s"],
  "coverageDirectory": "../coverage",
  "testEnvironment": "node"
}
```

### **–ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∞:**

**1. –û–±–Ω–æ–≤–∏—Ç—å test/jest-e2e.json:**

```json
{
  "moduleFileExtensions": ["js", "json", "ts"],
  "rootDir": "../",
  "modulePaths": ["<rootDir>"],
  "testEnvironment": "node",
  "testRegex": ".e2e-spec.ts$",
  "transform": {
    "^.+\\.(t|j)s$": "ts-jest"
  }
}
```

**2. –û–±–Ω–æ–≤–∏—Ç—å package.json (jest —Å–µ–∫—Ü–∏—è):**

```json
"jest": {
  "moduleFileExtensions": ["js", "json", "ts"],
  "rootDir": "./",
  "modulePaths": ["<rootDir>"],
  "testRegex": ".*\\.spec\\.ts$",
  "transform": {
    "^.+\\.(t|j)s$": "ts-jest"
  },
  "collectCoverageFrom": ["**/*.(t|j)s"],
  "coverageDirectory": "../coverage",
  "testEnvironment": "node"
}
```

## üîÆ **–ß–¢–û –ë–£–î–ï–¢ –î–ê–õ–¨–®–ï**

–ê–≤—Ç–æ—Ä –Ω–∞–º–µ–∫–∞–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ç–µ–º—É:

> "The whole idea of setting a development environment is that I want to load a different env file for development, for testing and any other environment"

**–í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ –æ–Ω –ø–æ–∫–∞–∂–µ—Ç:**

- –°–æ–∑–¥–∞–Ω–∏–µ `.env.development`, `.env.test`, `.env.production`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ .env —Ñ–∞–π–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç NODE_ENV
- –ö–∞–∫ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å NODE_ENV=development –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üí° **–ö–õ–Æ–ß–ï–í–´–ï –í–´–í–û–î–´**

1. **Jest –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç** `NODE_ENV=test` –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤
2. **NODE_ENV** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ä–µ–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π –≤ Jest** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π
4. **`<rootDir>`** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è Jest –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—É—Ç–µ–π
5. **–†–∞–∑–Ω—ã–µ —Å—Ä–µ–¥—ã = —Ä–∞–∑–Ω—ã–µ .env —Ñ–∞–π–ª—ã** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å, –∫ –∫–æ—Ç–æ—Ä–æ–π –¥–≤–∏–∂–µ—Ç—Å—è –∞–≤—Ç–æ—Ä

–≠—Ç–æ—Ç —É—Ä–æ–∫ –∑–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ä–µ–¥–∞–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ NestJS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏! üöÄ
