## üéØ **–û–°–ù–û–í–ù–ê–Ø –¶–ï–õ–¨ –£–†–û–ö–ê**

–ê–≤—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–∫–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é environment variables** —Å –ø–æ–º–æ—â—å—é –ø–∞–∫–µ—Ç–∞ Joi, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–æ—Å—å —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∏–ª–∏ –Ω–µ–ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

## üì¶ **–®–ê–ì 1: –£–°–¢–ê–ù–û–í–ö–ê JOI**

### **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏:**

```bash
npm install joi@17.12.2
```

**–ü–æ—á–µ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è:**

- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –∫—É—Ä—Å–æ–º
- –ò–∑–±–µ–≥–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å breaking changes
- –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ - —Ñ–∏–∫—Å–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π

## üîß **–®–ê–ì 2: –°–û–ó–î–ê–ù–ò–ï –§–ê–ô–õ–ê –í–ê–õ–ò–î–ê–¶–ò–ò**

### **–§–∞–π–ª: `src/config/environment.validation.ts`**

```typescript
import * as Joi from "joi";

export default Joi.object({
  // –í–∞–ª–∏–¥–∞—Ü–∏—è NODE_ENV
  NODE_ENV: Joi.string()
    .valid("development", "test", "production", "staging")
    .default("development"),

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ä—Ç–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  DATABASE_PORT: Joi.number()
    .port() // –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —á—Ç–æ —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–π –ø–æ—Ä—Ç
    .default(5432), // –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
  DATABASE_PASSWORD: Joi.string().required(),
  DATABASE_HOST: Joi.string().required(),
  DATABASE_NAME: Joi.string().required(),
  DATABASE_USER: Joi.string().required(),

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –º–æ–¥—É–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  PROFILE_API_KEY: Joi.string().required(),
});
```

## üîç **–î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–ó–ë–û–† –°–•–ï–ú–´ –í–ê–õ–ò–î–ê–¶–ò–ò**

### **1. –í–∞–ª–∏–¥–∞—Ü–∏—è NODE_ENV:**

```typescript
NODE_ENV: Joi.string()
  .valid('development', 'test', 'production', 'staging') // ‚úÖ –¢–æ–ª—å–∫–æ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è
  .default('development'),                               // ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

**–ß—Ç–æ —ç—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**

- –î–æ–ø—É—Å—Ç–∏–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `development`, `test`, `production`, `staging`
- –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `development`
- –õ—é–±–æ–µ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã–∑–æ–≤–µ—Ç –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### **2. –í–∞–ª–∏–¥–∞—Ü–∏—è —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π:**

```typescript
DATABASE_PORT: Joi.number()    // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º
  .port()                      // ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω—ã–º –Ω–æ–º–µ—Ä–æ–º –ø–æ—Ä—Ç–∞ (1-65535)
  .default(5432),              // ‚úÖ –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
```

### **3. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å—Ç—Ä–æ–∫:**

```typescript
DATABASE_PASSWORD: Joi.string().required(),
// ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π
// ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –∏–ª–∏ undefined)
```

## ‚öôÔ∏è **–®–ê–ì 3: –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò –ö CONFIGMODULE**

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `app.module.ts`:**

```typescript
import environmentValidation from './config/environment.validation';

@Module({
  imports: [
    ConfigModule.forRoot({
      isGlobal: true,
      envFilePath: env ? `.env.${env}` : '.env',
      load: [appConfig, databaseConfig],
      validationSchema: environmentValidation,  // ‚úÖ –î–æ–±–∞–≤–ª—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é
    }),
    // ...
  ],
})
```

## üß™ **–®–ê–ì 4: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –í–ê–õ–ò–î–ê–¶–ò–ò**

### **–¢–µ—Å—Ç 1: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è**

**–£–¥–∞–ª—è–µ–º –∏–∑ .env.development:**

```env
# –£–î–ê–õ–ï–ù–û:
PROFILE_API_KEY=google_profile_api_key_12345
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**

```
Error: Config validation error: "PROFILE_API_KEY" is required
```

### **–¢–µ—Å—Ç 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–æ—Ä—Ç–∞**

**–ò–∑–º–µ–Ω—è–µ–º –≤ .env.development:**

```env
DATABASE_PORT=999999  # ‚ùå –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π –ø–æ—Ä—Ç
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**

```
Error: Config validation error: "DATABASE_PORT" must be a valid port
```

### **–¢–µ—Å—Ç 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ NODE_ENV**

**–ò–∑–º–µ–Ω—è–µ–º –≤ package.json:**

```json
"start:dev": "NODE_ENV=invalid_value nest start --watch"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:**

```
Error: Config validation error: "NODE_ENV" must be one of [development, test, production, staging]
```

## üéØ **–ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –í–ê–õ–ò–î–ê–¶–ò–ò ENVIRONMENT VARIABLES**

### **1. –†–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –æ—à–∏–±–æ–∫:**

```typescript
// –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
// –û—à–∏–±–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è —Å—Ä–∞–∑—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ, –∞ –Ω–µ –≤ runtime
```

### **2. –ß–µ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö:**

```
// –í–º–µ—Å—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ë–î –ø–æ–ª—É—á–∞–µ–º:
"DATABASE_PASSWORD is required"
"DATABASE_PORT must be a valid port"
```

### **3. –ó–∞—â–∏—Ç–∞ –æ—Ç —á–µ–ª–æ–≤–µ—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫:**

```typescript
// –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –∑–∞–±—É–¥—É—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
// –ù–µ –Ω—É–∂–Ω–æ "–ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞—Ç—å" .env —Ñ–∞–π–ª—ã –º–µ–∂–¥—É —Å–æ–±–æ–π
```

### **4. –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**

```typescript
// –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∏—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –æ–ø–∏—Å–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
// –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
```

## üîß **–†–ê–°–®–ò–†–ï–ù–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò JOI**

### **–í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤:**

```typescript
EMAIL: Joi.string().email().required(),        // ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π email
URL: Joi.string().uri().required(),            // ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π URL
HOSTNAME: Joi.string().hostname().required(),  // ‚úÖ –í–∞–ª–∏–¥–Ω—ã–π hostname
```

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª–∏–Ω:**

```typescript
PASSWORD: Joi.string().min(8).max(100).required(),  // ‚úÖ –î–ª–∏–Ω–∞ 8-100 —Å–∏–º–≤–æ–ª–æ–≤
CODE: Joi.string().length(6).required(),            // ‚úÖ –¢–æ—á–Ω–∞—è –¥–ª–∏–Ω–∞ 6 —Å–∏–º–≤–æ–ª–æ–≤
```

### **–ö–∞—Å—Ç–æ–º–Ω—ã–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```typescript
FEATURE_FLAG: Joi.string().valid('true', 'false').default('false'),
TIMEOUT: Joi.number().min(1000).max(30000).default(5000),
```

## üö® **–ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –°–¶–ï–ù–ê–†–ò–ò –ò–ó –†–ï–ê–õ–¨–ù–´–• –ü–†–û–ï–ö–¢–û–í**

### **–ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ—Ç –∞–≤—Ç–æ—Ä:**

> "People keep exchanging env files with each other"

**–ë–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–±—ã–≤–∞—é—Ç –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç —Å –Ω–µ–ø–æ–Ω—è—Ç–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
- –¢—Ä–∞—Ç–∏—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞ –æ—Ç–ª–∞–¥–∫—É

**–° –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π:**

- –ß–µ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- –ù–æ–≤—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å—Ä–∞–∑—É –ø–æ–Ω–∏–º–∞—é—Ç —á—Ç–æ –Ω—É–∂–Ω–æ
- –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üí° **–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–´–ï –ü–†–ê–ö–¢–ò–ö–ò**

### **1. .env.example —Ñ–∞–π–ª:**

```env
# .env.example
NODE_ENV=development
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=your_password
DATABASE_NAME=your_database
PROFILE_API_KEY=your_api_key
```

### **2. –†–∞–∑–Ω—ã–µ —Å—Ö–µ–º—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥:**

```typescript
// –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ validation —Å—Ö–µ–º—ã
// –¥–ª—è development, test, production
```

### **3. Conditional –≤–∞–ª–∏–¥–∞—Ü–∏—è:**

```typescript
Joi.object({
  NODE_ENV: Joi.string().valid("development", "production").required(),
  DEBUG: Joi.when("NODE_ENV", {
    is: "development",
    then: Joi.boolean().default(true),
    otherwise: Joi.boolean().default(false),
  }),
});
```

## üîß **–ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –°–£–©–ï–°–¢–í–£–Æ–©–ò–ú –ö–û–î–û–ú**

### **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

**–£–∂–µ –µ—Å—Ç—å –≤ .env.development:**

```env
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USER=postgres
DATABASE_PASSWORD=password
DATABASE_NAME=nestjs-blog
DATABASE_SYNC=true
DATABASE_AUTOLOAD=true
PROFILE_API_KEY=google_profile_api_key_12345
```

**–î–æ–±–∞–≤—å—Ç–µ –≤ —Å—Ö–µ–º—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**

```typescript
DATABASE_SYNC: Joi.string().valid('true', 'false').default('false'),
DATABASE_AUTOLOAD: Joi.string().valid('true', 'false').default('false'),
```

## üéØ **–†–ï–ó–Æ–ú–ï –í–ù–ï–î–†–ï–ù–ù–´–• –í–û–ó–ú–û–ñ–ù–û–°–¢–ï–ô**

### **–ß—Ç–æ —Ç–µ–ø–µ—Ä—å —É–º–µ–µ—Ç –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**

1. **‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** –≤—Å–µ—Ö environment variables –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
2. **‚úÖ –ß–µ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö** —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
3. **‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
4. **‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤** (–ø–æ—Ä—Ç—ã, —Å—Ç—Ä–æ–∫–∏, —á–∏—Å–ª–∞)
5. **‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π** NODE_ENV

### **–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã:**

```
1. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí ConfigModule –∑–∞–≥—Ä—É–∂–∞–µ—Ç .env —Ñ–∞–π–ª
2. ‚Üí Joi –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ —Å—Ö–µ–º–µ
3. ‚Üí –ï—Å–ª–∏ –æ—à–∏–±–∫–∏ ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏
4. ‚Üí –ï—Å–ª–∏ –≤—Å–µ OK ‚Üí –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –≤–∞–ª–∏–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
```

–≠—Ç–æ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è! üöÄ
