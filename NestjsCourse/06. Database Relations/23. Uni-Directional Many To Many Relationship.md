–û—Ç–ª–∏—á–Ω–æ! –†–∞–∑–±–µ—Ä—ë–º —ç—Ç–æ—Ç –≤–∞–∂–Ω—ã–π —É—Ä–æ–∫ –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é unidirectional (–æ–¥–Ω–æ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å–≤—è–∑–∏) Many-to-Many –æ—Ç–Ω–æ—à–µ–Ω–∏—è –º–µ–∂–¥—É Post –∏ Tag –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ.

## üîÑ **–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã Tags –≤ Post entity**

### **–ë—ã–ª–æ (—Å—Ç–∞—Ä–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞):**

```typescript
// –í Post.entity.ts
tags?: string[]; // –ü—Ä–æ—Å—Ç–æ –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ç–µ–≥–æ–≤
```

### **–°—Ç–∞–ª–æ (–Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Entity):**

```typescript
// –í Post.entity.ts
import { Tag } from "../tags/tag.entity";

// –ó–∞–º–µ–Ω—è–µ–º —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —Å—É—â–Ω–æ—Å—Ç–∏ Tag
@ManyToMany(() => Tag) // ‚Üê –î–µ–∫–æ—Ä–∞—Ç–æ—Ä Many-to-Many
@JoinTable()           // ‚Üê –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è junction table
tags?: Tag[];          // ‚Üê –¢–µ–ø–µ—Ä—å –º–∞—Å—Å–∏–≤ —Å—É—â–Ω–æ—Å—Ç–µ–π Tag
```

## üèóÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Many-to-Many –æ—Ç–Ω–æ—à–µ–Ω–∏—è**

### **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@ManyToMany`:**

```typescript
@ManyToMany(() => Tag)
```

- **–ü–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç**: `() => Tag` - —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ü–µ–ª–µ–≤—É—é —Å—É—â–Ω–æ—Å—Ç—å
- **Unidirectional** - —Ç–æ–ª—å–∫–æ Post –∑–Ω–∞–µ—Ç –æ Tag, –Ω–æ Tag –Ω–µ –∑–Ω–∞–µ—Ç –æ Post

### **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä `@JoinTable()`:**

```typescript
@JoinTable()
```

- **–û–±—è–∑–∞—Ç–µ–ª–µ–Ω** –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –≤ Many-to-Many
- **–°–æ–∑–¥–∞–µ—Ç junction table** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–í–ª–∞–¥–µ–ª–µ—Ü** - —Å—Ç–æ—Ä–æ–Ω–∞ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `@JoinTable()`

## üóÉÔ∏è **–ß—Ç–æ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è junction table:**

```sql
-- TypeORM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É:
CREATE TABLE post_tags_tag (
    "postId" integer REFERENCES post(id),
    "tagId" integer REFERENCES tag(id),
    PRIMARY KEY ("postId", "tagId")
);
```

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≤—è–∑–µ–π:**

```
Post entity          post_tags_tag junction table       Tag entity
+-------------+      +--------------------+          +-------------+
| id          |      | postId (FK)        |          | id          |
| title       |‚Üê----‚Üí| tagId  (FK)        |‚Üê--------‚Üí| name        |
| content     |      +--------------------+          | slug        |
| tags: Tag[] |      | (composite PK)     |          +-------------+
+-------------+      +--------------------+
```

## üìù **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CreatePostDto**

### **–ë—ã–ª–æ (–º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫):**

```typescript
@ApiPropertyOptional({
    description: "Array of tags passed as string values",
    example: ["nestjs", "typescript"],
})
@IsOptional()
@IsArray()
@IsString({ each: true })
@MinLength(3, { each: true })
tags?: string[];
```

### **–°—Ç–∞–ª–æ (–º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª - ID —Ç–µ–≥–æ–≤):**

```typescript
@ApiPropertyOptional({
    description: "Array of ids of tags", // ‚Üê –ò–∑–º–µ–Ω–∏–ª–æ—Å—å –æ–ø–∏—Å–∞–Ω–∏–µ
    example: [1, 2], // ‚Üê –¢–µ–ø–µ—Ä—å —á–∏—Å–ª–∞ (ID —Ç–µ–≥–æ–≤)
})
@IsOptional()
@IsArray()
@IsInt({ each: true }) // ‚Üê –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —á–∏—Å–ª–∞
tags?: number[]; // ‚Üê –¢–µ–ø–µ—Ä—å number[] –≤–º–µ—Å—Ç–æ string[]
```

## üîß **–°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ –≤ TagService**

### **–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `findMultipleTags`:**

```typescript
public async findMultipleTags(tags: number[]): Promise<Tag[]> {
    let results = await this.tagsRepository.find({
        where: {
            id: In(tags) // ‚Üê –ù–∞–π—Ç–∏ –≤—Å–µ —Ç–µ–≥–∏ —Å ID –≤ –º–∞—Å—Å–∏–≤–µ
        }
    });
    return results;
}
```

### **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ `In()` —Ñ—É–Ω–∫—Ü–∏–∏:**

```typescript
import { In } from "typeorm";

// In([1, 2, 3]) —Å–æ–∑–¥–∞–µ—Ç SQL —É—Å–ª–æ–≤–∏–µ:
// WHERE id IN (1, 2, 3)
// –ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ –∑–∞–ø–∏—Å–∏ –≥–¥–µ id —Ä–∞–≤–µ–Ω 1, 2 –∏–ª–∏ 3
```

## üîÑ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è TagService –≤ PostService**

### **–®–∞–≥ 1: –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è**

```typescript
// –í PostsModule
imports: [
    UsersModule,
    TagsModule, // ‚Üê –î–æ–±–∞–≤–ª—è–µ–º –∏–º–ø–æ—Ä—Ç TagsModule
    TypeOrmModule.forFeature([Post, MetaOption]),
    MetaOptionsModule,
],
```

### **–®–∞–≥ 2: –≠–∫—Å–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞**

```typescript
// –í TagsModule
@Module({
  controllers: [TagsController],
  providers: [TagsService],
  exports: [TagsService], // ‚Üê –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Å–µ—Ä–≤–∏—Å
})
export class TagsModule {}
```

### **–®–∞–≥ 3: –ò–Ω–∂–µ–∫—Ü–∏—è –≤ PostsService**

```typescript
// –í PostsService
constructor(
    private readonly usersService: UsersService,
    private readonly tagsService: TagsService, // ‚Üê –ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    @InjectRepository(Post)
    private readonly postsRepository: Repository<Post>,
    @InjectRepository(MetaOption)
    private readonly metaOptionsRepository: Repository<MetaOption>
) {}
```

## üõ†Ô∏è **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –º–µ—Ç–æ–¥ `create` –≤ PostsService:**

```typescript
public async create(createPostDto: CreatePostDto) {
    // 1. –ù–∞—Ö–æ–¥–∏–º –∞–≤—Ç–æ—Ä–∞
    const author = await this.usersService.findOneById(createPostDto.authorId);

    // 2. –ù–û–í–û–ï: –ù–∞—Ö–æ–¥–∏–º —Ç–µ–≥–∏
    const tags = await this.tagsService.findMultipleTags(createPostDto.tags || []);

    // 3. –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏
    let post = this.postsRepository.create({
        ...createPostDto,
        author,           // –°–≤—è–∑—å Many-to-One
        tags,             // ‚Üê –ù–û–í–û–ï: –°–≤—è–∑—å Many-to-Many
    });

    return await this.postsRepository.save(post);
}
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π POST –∑–∞–ø—Ä–æ—Å:**

```http
POST http://localhost:3000/posts
Content-Type: application/json

{
  "title": "NestJS Many-to-Many Example",
  "postType": "post",
  "slug": "nestjs-many-to-many-example",
  "status": "published",
  "authorId": 1,
  "tags": [1],  // ‚Üê –ù–û–í–û–ï: ID —Ç–µ–≥–∞ JavaScript
  "metaOptions": {
    "metaValue": "{\"sidebarEnabled\": true}"
  }
}
```

## üóÉÔ∏è **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

### **–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:**

**–¢–∞–±–ª–∏—Ü–∞ `posts`:**

```sql
id | title                          | authorId
7  | "NestJS Many-to-Many Example"  | 1
```

**–¢–∞–±–ª–∏—Ü–∞ `tags`:**

```sql
id | name        | slug
1  | JavaScript  | javascript
```

**Junction table `post_tags_tag` (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–∞):**

```sql
postId | tagId
7      | 1     -- –°–≤—è–∑—å –º–µ–∂–¥—É –ø–æ—Å—Ç–æ–º 7 –∏ —Ç–µ–≥–æ–º 1
```

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ PgAdmin**

### **–ê–≤—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:**

1. **–ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞** `post_tags_tag` —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. **–ó–∞–ø–∏—Å—å –≤ junction table** —Å–≤—è–∑—ã–≤–∞–µ—Ç –ø–æ—Å—Ç –∏ —Ç–µ–≥
3. **–î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã** - postId 7 ‚Üí tagId 1

## üéØ **–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

### **1. Unidirectional vs Bidirectional:**

- **Unidirectional**: –¢–æ–ª—å–∫–æ Post –∑–Ω–∞–µ—Ç –æ Tag (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
- **Bidirectional**: –û–±–µ —Å—É—â–Ω–æ—Å—Ç–∏ –∑–Ω–∞—é—Ç –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ (–±—É–¥–µ—Ç –ø–æ–∑–∂–µ)

### **2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ junction table:**

- TypeORM —Å–∞–º —Å–æ–∑–¥–∞–µ—Ç –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç `post_tags_tag`
- –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
- –ù–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å SQL –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ junction table

### **3. –ö–∞—Å–∫–∞–¥–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

```typescript
// –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–≥–æ–≤
@ManyToMany(() => Tag, {
    cascade: true // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –Ω–æ–≤—ã–µ —Ç–µ–≥–∏
})
@JoinTable()
tags?: Tag[];
```

## ‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è**

### **–ï—Å–ª–∏ —Ç–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã:**

```typescript
// –°–µ–π—á–∞—Å: –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
const tags = await this.tagsService.findMultipleTags(createPostDto.tags || []);

// –ë—É–¥—É—â–µ–µ: –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
if (createPostDto.tags && createPostDto.tags.length > 0) {
  const foundTags = await this.tagsService.findMultipleTags(createPostDto.tags);
  if (foundTags.length !== createPostDto.tags.length) {
    // –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–≥–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
    throw new BadRequestException("Some tags were not found");
  }
}
```

## üí° **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**

### **1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**

- –¢–µ–≥–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –≤ —Ç–∞–±–ª–∏—Ü–µ `tags`
- –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–µ–≥–æ–≤ –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏
- –õ–µ–≥–∫–æ –∏–∑–º–µ–Ω—è—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–µ–≥–æ–≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ

### **2. –ì–∏–±–∫–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤:**

```typescript
// –ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ—Å—Ç—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–µ–≥–æ–º
const posts = await postRepository.find({
  where: {
    tags: { id: 1 }, // –í—Å–µ –ø–æ—Å—Ç—ã —Å —Ç–µ–≥–æ–º JavaScript
  },
});
```

### **3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ JOIN –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ junction table
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —Å–æ—Å—Ç–∞–≤–Ω–æ–º –ø–µ—Ä–≤–∏—á–Ω–æ–º –∫–ª—é—á–µ
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–≤—è–∑–µ–π

## üöÄ **–ß—Ç–æ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ –≤ —ç—Ç–æ–º —É—Ä–æ–∫–µ**

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**

- ‚úÖ **Many-to-Many –æ—Ç–Ω–æ—à–µ–Ω–∏–µ** –º–µ–∂–¥—É Post –∏ Tag
- ‚úÖ **Unidirectional —Å–≤—è–∑—å** –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ **Junction table** —Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ —Å —Ç–µ–≥–∞–º–∏** —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è DTO** –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ID —Ç–µ–≥–æ–≤

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

- ‚úÖ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- ‚úÖ **–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∂–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**
- ‚úÖ **TypeORM –æ—Ç–Ω–æ—à–µ–Ω–∏—è** –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ

## üîú **–ß—Ç–æ –±—É–¥–µ—Ç –¥–∞–ª—å—à–µ**

### **–ü–ª–∞–Ω –∞–≤—Ç–æ—Ä–∞:**

1. **Bidirectional Many-to-Many** - –∫–æ–≥–¥–∞ Tag —Ç–æ–∂–µ –±—É–¥–µ—Ç –∑–Ω–∞—Ç—å –æ Post
2. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–≥–æ–≤, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–≥–∞–º
3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤** - eager/lazy loading –¥–ª—è Many-to-Many

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–≥–æ–≤, –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å –ø–æ—Å—Ç–∞–º–∏ —á–µ—Ä–µ–∑ Many-to-Many –æ—Ç–Ω–æ—à–µ–Ω–∏—è! üöÄ
