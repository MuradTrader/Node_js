## üîÑ **–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Unidirectional ‚Üí Bidirectional**

### **–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (Unidirectional):**

```typescript
// –í Post.entity.ts - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ —Å—Ç–æ—Ä–æ–Ω–∞ –∑–Ω–∞–µ—Ç –æ —Å–≤—è–∑–∏
@ManyToMany(() => Tag, { eager: true })
@JoinTable()
tags?: Tag[];

// –í Tag.entity.ts - –ù–ï–¢ —Å—Å—ã–ª–∫–∏ –Ω–∞ Post
@Entity()
export class Tag {
    // ... —Å–≤–æ–π—Å—Ç–≤–∞, –Ω–æ –Ω–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ Post
}
```

## üèóÔ∏è **–®–∞–≥ 1: –î–æ–±–∞–≤–ª—è–µ–º —Å–≤—è–∑—å –≤ Tag entity**

### **–ù–æ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –≤ Tag.entity.ts:**

```typescript
import { Post } from "./post.entity";

@Entity()
export class Tag {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ (id, name, slug, description, etc.)

  // –ù–û–í–û–ï: –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å Many-to-Many —Å Post
  @ManyToMany(() => Post, (post) => post.tags) // ‚Üê –î–µ–∫–æ—Ä–∞—Ç–æ—Ä —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Å—ã–ª–∫–æ–π
  posts: Post[]; // –ú–∞—Å—Å–∏–≤ –ø–æ—Å—Ç–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º
}
```

### **–†–∞–∑–±–æ—Ä –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ –≤ Tag entity:**

```typescript
@ManyToMany(() => Post, post => post.tags)
```

- **`() => Post`** - —Ü–µ–ª–µ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å–≤—è–∑–∏
- **`post => post.tags`** - –æ–±—Ä–∞—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–æ –≤ Post entity
- **–û–∑–Ω–∞—á–∞–µ—Ç**: "–≠—Ç–æ—Ç Tag —Å–≤—è–∑–∞–Ω —Å Post —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ `tags` –≤ Post"

## üîß **–®–∞–≥ 2: –û–±–Ω–æ–≤–ª—è–µ–º —Å–≤—è–∑—å –≤ Post entity**

### **–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä –≤ Post.entity.ts:**

```typescript
// –ë–´–õ–û:
@ManyToMany(() => Tag, { eager: true })
@JoinTable()
tags?: Tag[];

// –°–¢–ê–õ–û:
@ManyToMany(() => Tag, tag => tag.posts, { eager: true }) // ‚Üê –î–æ–±–∞–≤–∏–ª–∏ –æ–±—Ä–∞—Ç–Ω—É—é —Å—Å—ã–ª–∫—É
@JoinTable()
tags?: Tag[];
```

### **–†–∞–∑–±–æ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞:**

```typescript
@ManyToMany(() => Tag, tag => tag.posts, { eager: true })
```

- **`() => Tag`** - —Ü–µ–ª–µ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å —Å–≤—è–∑–∏
- **`tag => tag.posts`** - –æ–±—Ä–∞—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–≤–æ–π—Å—Ç–≤–æ –≤ Tag entity
- **`{ eager: true }`** - –æ–ø—Ü–∏–∏ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞)
- **–û–∑–Ω–∞—á–∞–µ—Ç**: "–≠—Ç–æ—Ç Post —Å–≤—è–∑–∞–Ω —Å Tag —á–µ—Ä–µ–∑ —Å–≤–æ–π—Å—Ç–≤–æ `posts` –≤ Tag"

## üéØ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Bidirectional Relationship**

### **–ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ —Å–≤—è–∑–µ–π:**

```
Post entity (–í–ª–∞–¥–µ–ª–µ—Ü)          Tag entity (–û–±—Ä–∞—Ç–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
+-------------+                  +-------------+
| id          |                  | id          |
| title       |                  | name        |
| content     |                  | slug        |
| tags: Tag[] | ‚Üê--- –°–í–Ø–ó–¨ ---‚Üí | posts: Post[]|
+-------------+                  +-------------+
      ‚Üì                                ‚Üì
@JoinTable()                      –ë–µ–∑ @JoinTable()
```

### **–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏:**

**–û—Ç Post –∫ Tag (–∫–∞–∫ –∏ —Ä–∞–Ω—å—à–µ):**

```typescript
const post = await postRepository.findOne({ relations: ["tags"] });
console.log(post.tags); // [Tag, Tag, Tag] - –≤—Å–µ —Ç–µ–≥–∏ –ø–æ—Å—Ç–∞
```

**–û—Ç Tag –∫ Post (–ù–û–í–ê–Ø –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å):**

```typescript
const tag = await tagRepository.findOne({
  where: { id: 1 },
  relations: ["posts"], // ‚Üê –¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–æ—Å—Ç—ã!
});
console.log(tag.posts); // [Post, Post, Post] - –≤—Å–µ –ø–æ—Å—Ç—ã —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º
```

## üóÉÔ∏è **–ß—Ç–æ –ù–ï –º–µ–Ω—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö**

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π:**

```sql
-- –¢–∞–±–ª–∏—Ü—ã –Ω–µ –º–µ–Ω—è—é—Ç—Å—è:
posts (id, title, content, ...)
tags (id, name, slug, ...)
post_tags_tag (postId, tagId) -- junction table
```

### **Junction table —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- **–í–ª–∞–¥–µ–ª–µ—Ü** –≤—Å–µ –µ—â–µ Post (–∏–∑-–∑–∞ `@JoinTable()`)
- **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫ –∂–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** —Å–≤—è–∑–µ–π –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è

## üîç **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**

### **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏–º–µ–Ω:**

```typescript
// –í Post.entity.ts
tags?: Tag[];           // –ò–º—è —Å–≤–æ–π—Å—Ç–≤–∞: "tags"

// –í Tag.entity.ts
posts: Post[];          // –ò–º—è —Å–≤–æ–π—Å—Ç–≤–∞: "posts"

// –û–±—Ä–∞—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∏–º–µ–Ω–∞–º–∏ —Å–≤–æ–π—Å—Ç–≤
post => post.tags       // –°—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ "tags" –≤ Post
tag => tag.posts        // –°—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ "posts" –≤ Tag
```

### **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤:**

**–ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ-–≤–ª–∞–¥–µ–ª—å—Ü–µ (Post):**

```typescript
@ManyToMany(() => Tag, tag => tag.posts) // –û–±—Ä–∞—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ Tag
@JoinTable() // –¢–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ!
tags?: Tag[];
```

**–ù–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ (Tag):**

```typescript
@ManyToMany(() => Post, post => post.tags) // –û–±—Ä–∞—Ç–Ω–∞—è —Å—Å—ã–ª–∫–∞ –Ω–∞ Post
// –ù–ï–¢ @JoinTable()!
posts: Post[];
```

## üöÄ **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Bidirectional**

### **1. –ó–∞–ø—Ä–æ—Å—ã –æ—Ç —Ç–µ–≥–∞ –∫ –ø–æ—Å—Ç–∞–º:**

```typescript
// –ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ—Å—Ç—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–µ–≥–æ–º
const typescriptTag = await tagRepository.findOne({
  where: { name: "TypeScript" },
  relations: ["posts"], // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–≤—è–∑–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—ã
});

console.log(typescriptTag.posts); // –í—Å–µ –ø–æ—Å—Ç—ã —Å —Ç–µ–≥–æ–º TypeScript
```

### **2. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–≤—è–∑—è–º:**

```typescript
// –ù–∞–π—Ç–∏ —Ç–µ–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –±–æ–ª–µ–µ —á–µ–º 5 –ø–æ—Å—Ç–∞—Ö
// (–ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∫–∞—Å—Ç–æ–º–Ω—ã–π –º–µ—Ç–æ–¥)
```

### **3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã:**

```typescript
// –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Ç–µ–≥–æ–≤
const tagsWithPostCount = await tagRepository
  .createQueryBuilder("tag")
  .loadRelationCountAndMap("tag.postsCount", "tag.posts")
  .getMany();
```

## ‚ö†Ô∏è **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ bidirectional**

### **–ü—Ä–æ–±–ª–µ–º–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

```typescript
// –ï—Å–ª–∏ –æ–±–∞ —Å–≤–æ–π—Å—Ç–≤–∞ –∏–º–µ—é—Ç eager: true
@ManyToMany(() => Tag, tag => tag.posts, { eager: true })
tags?: Tag[];

@ManyToMany(() => Post, post => post.tags, { eager: true })
posts: Post[];

// –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏ –≤ JSON!
```

### **–†–µ—à–µ–Ω–∏–µ:**

```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å eager —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω–µ
// –ò–ª–∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ relations –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
```

## üí° **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª—å–∑–∞ –≤ –±–ª–æ–≥-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏**

### **Use Case 1: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ–≥–∞**

```typescript
// –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–µ–≥–æ–º
async getTagWithPosts(tagId: number) {
    return this.tagRepository.findOne({
        where: { id: tagId },
        relations: ['posts'] // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å—Ç—ã —ç—Ç–æ–≥–æ —Ç–µ–≥–∞
    });
}
```

### **Use Case 2: –û–±–ª–∞–∫–æ —Ç–µ–≥–æ–≤ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º**

```typescript
// –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–µ–≥–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ—Å—Ç–æ–≤
async getPopularTags() {
    // –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π –º–µ—Ç–æ–¥ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
    // –∫–æ—Ç–æ—Ä—ã–π –≤–µ—Ä–Ω–µ—Ç —Ç–µ–≥–∏ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
}
```

### **Use Case 3: –ü–æ—Ö–æ–∂–∏–µ –ø–æ—Å—Ç—ã**

```typescript
// –ù–∞–π—Ç–∏ –ø–æ—Å—Ç—ã —Å –ø–æ—Ö–æ–∂–∏–º–∏ —Ç–µ–≥–∞–º–∏
async getRelatedPosts(postId: number) {
    const post = await this.postRepository.findOne({
        where: { id: postId },
        relations: ['tags']
    });

    // –ù–∞–π—Ç–∏ –¥—Ä—É–≥–∏–µ –ø–æ—Å—Ç—ã —Å —ç—Ç–∏–º–∏ —Ç–µ–≥–∞–º–∏
    return this.postRepository.find({
        where: {
            tags: In(post.tags.map(tag => tag.id)),
            id: Not(postId)
        }
    });
}
```

## üîÑ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π**

### **Unidirectional (–±—ã–ª–æ):**

- ‚úÖ **Post ‚Üí Tag**: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå **Tag ‚Üí Post**: –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ–π –∫–æ–¥**

### **Bidirectional (—Å—Ç–∞–ª–æ):**

- ‚úÖ **Post ‚Üí Tag**: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **Tag ‚Üí Post**: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ **–ì–∏–±–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã**
- ‚ö†Ô∏è **–°–ª–æ–∂–Ω–µ–µ –∫–æ–¥** (–Ω–æ –º–æ—â–Ω–µ–µ)

## üéØ **–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ**

### **Tag.entity.ts:**

```typescript
// –î–û–ë–ê–í–õ–ï–ù–û:
@ManyToMany(() => Post, post => post.tags)
posts: Post[];
```

### **Post.entity.ts:**

```typescript
// –û–ë–ù–û–í–õ–ï–ù–û:
@ManyToMany(() => Tag, tag => tag.posts, { eager: true })
@JoinTable()
tags?: Tag[];
```

## üöÄ **–ß—Ç–æ –±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–¥–µ–æ**

### **–ê–≤—Ç–æ—Ä –ø–æ–∫–∞–∂–µ—Ç:**

- –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ bidirectional —Å–≤—è–∑–µ–π
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Tag –∫ Post
- –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- –†–µ–∞–ª—å–Ω—ã–µ use cases –¥–ª—è bidirectional –æ—Ç–Ω–æ—à–µ–Ω–∏–π

## üíé **–ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã**

1. **Bidirectional Many-to-Many** —Å–æ–∑–¥–∞–µ—Ç—Å—è –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –æ–±—Ä–∞—Ç–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –≤ –æ–±–µ —Å—É—â–Ω–æ—Å—Ç–∏
2. **@JoinTable()** –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ-–≤–ª–∞–¥–µ–ª—å—Ü–µ (Post)
3. **–û–±—Ä–∞—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏** –¥–æ–ª–∂–Ω—ã —Ç–æ—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∏–º–µ–Ω–∞–º–∏ —Å–≤–æ–π—Å—Ç–≤
4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è** - –º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
5. **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏** –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç —Ç–µ–≥–æ–≤ –∫ –ø–æ—Å—Ç–∞–º

–¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω—è—è —Å–≤—è–∑—å –º–µ–∂–¥—É –ø–æ—Å—Ç–∞–º–∏ –∏ —Ç–µ–≥–∞–º–∏! üöÄ
