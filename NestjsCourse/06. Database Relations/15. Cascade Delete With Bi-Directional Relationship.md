## üîÑ **–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è**

### **–ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:**

**–†—É—á–Ω–æ–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:**

```typescript
public async delete(id: number) {
    let post = await this.postsRepository.findOneBy({ id });
    await this.postsRepository.delete(id);
    await this.metaOptionsRepository.delete(post.metaOptions.id); // ‚Üê –†—É—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**

- –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
- –†–∏—Å–∫ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
- –°–ª–æ–∂–Ω—ã–π –∫–æ–¥ —Å –º–µ–∂–º–æ–¥—É–ª—å–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏

## üóÉÔ∏è **–ö–ª—é—á–µ–≤–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: –ø–µ—Ä–µ–Ω–æ—Å Foreign Key (–í–Ω–µ—à–Ω—ã–π –∫–ª—é—á)**

### **–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:**

**–õ–æ–≥–∏–∫–∞ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è:**

- –ï—Å–ª–∏ foreign key –≤ `posts` ‚Üí –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å post –ø–µ—Ä–≤—ã–º (–Ω–∞—Ä—É—à–∏—Ç—Å—è constraint)
- –ï—Å–ª–∏ foreign key –≤ `meta_options` ‚Üí –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å post, –∞ meta_option —É–¥–∞–ª–∏—Ç—Å—è –∫–∞—Å–∫–∞–¥–Ω–æ

### **–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**

**–ë—ã–ª–æ –≤ `Post.entity.ts`:**

```typescript
@OneToOne(() => MetaOption, metaOption => metaOption.post, {
    cascade: true,
    eager: true
})
@JoinColumn() // ‚Üê Foreign key –≤ posts —Ç–∞–±–ª–∏—Ü–µ
metaOptions?: MetaOption;
```

**–°—Ç–∞–ª–æ –≤ `Post.entity.ts`:**

```typescript
@OneToOne(() => MetaOption, metaOption => metaOption.post, {
    cascade: true,
    eager: true
})
// @JoinColumn –£–ë–†–ê–õ–ò –æ—Ç—Å—é–¥–∞!
metaOptions?: MetaOption;
```

**–î–æ–±–∞–≤–∏–ª–∏ –≤ `MetaOption.entity.ts`:**

```typescript
@OneToOne(() => Post, post => post.metaOptions, {
    onDelete: 'CASCADE' // ‚Üê –ö–ª—é—á–µ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ!
})
@JoinColumn() // ‚Üê Foreign key —Ç–µ–ø–µ—Ä—å –≤ meta_options —Ç–∞–±–ª–∏—Ü–µ
post: Post;
```

## üèóÔ∏è **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**

### **–î–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ posts
id | title      | metaOptionsId  ‚Üê FOREIGN KEY –ó–î–ï–°–¨
1  | "My Post"  | 1

-- –¢–∞–±–ª–∏—Ü–∞ meta_option
id | metaValue
1  | '{"sidebar": true}'
```

### **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ posts (–ë–ï–ó foreign key)
id | title
1  | "My Post"

-- –¢–∞–±–ª–∏—Ü–∞ meta_option
id | metaValue           | postId  ‚Üê FOREIGN KEY –ü–ï–†–ï–ú–ï–°–¢–ò–õ–°–Ø –°–Æ–î–ê
1  | '{"sidebar": true}' | 1
```

## ‚öôÔ∏è **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `onDelete: 'CASCADE'`**

### **–ß—Ç–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç:**

```typescript
@OneToOne(() => Post, post => post.metaOptions, {
    onDelete: 'CASCADE' // ‚Üê –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Post –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–∏—Ç—Å—è MetaOption
})
```

**–ê–Ω–∞–ª–æ–≥–∏—è —Å SQL:**

```sql
-- –¢–æ –∂–µ —Å–∞–º–æ–µ —á—Ç–æ –≤ —á–∏—Å—Ç–æ–º SQL:
ALTER TABLE meta_option
ADD CONSTRAINT fk_meta_option_post
FOREIGN KEY (postId) REFERENCES post(id)
ON DELETE CASCADE;
```

### **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

1. **–£–¥–∞–ª—è–µ–º Post** —á–µ—Ä–µ–∑ `postsRepository.delete(id)`
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ MetaOption
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç** —ç—Ç–∏ MetaOption –∑–∞–ø–∏—Å–∏
4. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** - –Ω–µ—Ç "–æ—Å–∏—Ä–æ—Ç–µ–≤—à–∏—Ö" –∑–∞–ø–∏—Å–µ–π

## üîß **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ PostsService**

### **–ë—ã–ª–æ (—Å–ª–æ–∂–Ω—ã–π –∫–æ–¥):**

```typescript
public async delete(id: number) {
    // 1. –ù–∞–π—Ç–∏ –ø–æ—Å—Ç (—á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å metaOptions.id)
    let post = await this.postsRepository.findOneBy({ id });

    // 2. –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
    await this.postsRepository.delete(id);

    // 3. –£–¥–∞–ª–∏—Ç—å –º–µ—Ç–∞-–æ–ø—Ü–∏—é –≤—Ä—É—á–Ω—É—é
    await this.metaOptionsRepository.delete(post.metaOptions.id);

    return { deleted: true, id: post.id };
}
```

### **–°—Ç–∞–ª–æ (–ø—Ä–æ—Å—Ç–æ–π –∫–æ–¥):**

```typescript
public async delete(id: number) {
    // –¢–û–õ–¨–ö–û –≠–¢–û - –æ—Å—Ç–∞–ª—å–Ω–æ–µ –¥–µ–ª–∞–µ—Ç –ë–î –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
    await this.postsRepository.delete(id);

    return { deleted: true, id };
}
```

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞**

### **1. –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞:**

- **–£–±—Ä–∞–ª–∏ 2 –∏–∑ 3 —à–∞–≥–æ–≤** —É–¥–∞–ª–µ–Ω–∏—è
- **–ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏** –≤ —Ä—É—á–Ω–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏
- **–ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ** –∏ –ø—Ä–æ—â–µ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è

### **2. –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

- **–ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤** –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (1 –≤–º–µ—Å—Ç–æ 3)
- **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è** –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î

### **3. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

```typescript
// –ë–´–õ–û: –ù—É–∂–Ω—ã –æ–±–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
constructor(
    @InjectRepository(Post) private readonly postsRepository: Repository<Post>,
    @InjectRepository(MetaOption) private readonly metaOptionsRepository: Repository<MetaOption>
)

// –°–¢–ê–õ–û: –ù—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ postsRepository
constructor(
    @InjectRepository(Post) private readonly postsRepository: Repository<Post>
    // metaOptionsRepository –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω!
)
```

## üß™ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è**

### **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**

```http
POST http://localhost:3000/posts
Content-Type: application/json

{
  "title": "Test Cascade Delete",
  "postType": "post",
  "slug": "test-cascade-delete",
  "status": "published",
  "metaOptions": {
    "metaValue": "{\"sidebarEnabled\": true}"
  }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î:**

```
posts: id=4, title="Test Cascade Delete"
meta_option: id=4, postId=4, metaValue='{"sidebarEnabled": true}'
```

### **–¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è:**

```http
DELETE http://localhost:3000/posts?id=4
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ë–î:**

1. `DELETE FROM posts WHERE id = 4`
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**: `DELETE FROM meta_option WHERE postId = 4`

## üîç **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ PgAdmin**

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü:**

1. **Posts —Ç–∞–±–ª–∏—Ü–∞**: –£–±–µ–¥–∏–ª–∏—Å—å, —á—Ç–æ `metaOptionsId` —Å—Ç–æ–ª–±–µ—Ü –∏—Å—á–µ–∑
2. **Meta_option —Ç–∞–±–ª–∏—Ü–∞**: –£–±–µ–¥–∏–ª–∏—Å—å, —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è `postId` —Å—Ç–æ–ª–±–µ—Ü
3. **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –£–¥–∞–ª–∏–ª–∏ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞

### **–í–∏–∑—É–∞–ª—å–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:**

```sql
-- –î–æ —É–¥–∞–ª–µ–Ω–∏—è:
SELECT * FROM posts WHERE id = 4;        -- ‚úì –ï—Å—Ç—å –∑–∞–ø–∏—Å—å
SELECT * FROM meta_option WHERE id = 4;  -- ‚úì –ï—Å—Ç—å –∑–∞–ø–∏—Å—å

-- –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:
SELECT * FROM posts WHERE id = 4;        -- ‚ùå –ù–µ—Ç –∑–∞–ø–∏—Å–∏
SELECT * FROM meta_option WHERE id = 4;  -- ‚ùå –ù–µ—Ç –∑–∞–ø–∏—Å–∏ (—É–¥–∞–ª–∏–ª–∞—Å—å –∫–∞—Å–∫–∞–¥–Ω–æ)
```

## üí° **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**

### **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**

- **PostsService** –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –ø–æ—Å—Ç—ã
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ö–∞–∂–¥–∞—è —Å—É—â–Ω–æ—Å—Ç—å** —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏–º–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏

### **–£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏:**

```typescript
// –¢–µ–ø–µ—Ä—å –ø—Ä–æ—â–µ –º–æ–∫–∞—Ç—å - —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
const mockPostsRepository = {
    delete: jest.fn()
};

// –í–º–µ—Å—Ç–æ –¥–≤—É—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
const mockPostsRepository = { ... };
const mockMetaOptionsRepository = { ... };
```

## üö® **–í–∞–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ considerations**

### **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ:**

- ‚úÖ **–°–∏–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**: MetaOption –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞ –±–µ–∑ Post
- ‚úÖ **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª**: MetaOption –¥–æ–ª–∂–µ–Ω –∂–∏—Ç—å –∏ —É–º–∏—Ä–∞—Ç—å –≤–º–µ—Å—Ç–µ —Å Post
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –•–æ—Ç–∏–º —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏

### **–ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

- ‚ùå **–ù–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ**: –ï—Å–ª–∏ MetaOption –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–µ–∑ Post
- ‚ùå **–°–ª–æ–∂–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**: –ï—Å–ª–∏ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
- ‚ùå **–ê—É–¥–∏—Ç–æ—Ä—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéØ **–ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã**

1. **–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ** —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å–∞ foreign key –≤ –¥–æ—á–µ—Ä–Ω—é—é —Ç–∞–±–ª–∏—Ü—É
2. **`onDelete: 'CASCADE'`** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
3. **–ö–æ–¥ —É–ø—Ä–æ—â–∞–µ—Ç—Å—è** —Å 3 –æ–ø–µ—Ä–∞—Ü–∏–π –¥–æ 1
4. **–£–±–∏—Ä–∞—é—Ç—Å—è –º–µ–∂–º–æ–¥—É–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
5. **–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–≠—Ç–æ –º–æ—â–Ω–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∞–µ—Ç –∫–æ–¥ —á–∏—â–µ, –ø—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ! üöÄ
