## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥: —Ä–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã**

### **–ü—Ä–æ–±–ª–µ–º–∞ –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ–º:**

–î–æ —ç—Ç–æ–≥–æ –º—ã –∏–Ω–∂–µ–∫—Ç–∏–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥—Ä—É–≥–∏—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –Ω–∞–ø—Ä—è–º—É—é, —á—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –º–µ–∂–º–æ–¥—É–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏. –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥ - —Ä–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å—ã.

## üìù **–®–∞–≥ 1: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è CreatePostDto**

### **–î–æ–±–∞–≤–ª—è–µ–º authorId –≤ DTO:**

**–ë—ã–ª–æ –≤ `create-post.dto.ts`:**

```typescript
export class CreatePostDto {
  title: string;
  postType: postType;
  slug: string;
  status: postStatus;
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
  // –ù–ï–¢ authorId!
}
```

**–°—Ç–∞–ª–æ:**

```typescript
export class CreatePostDto {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è

  @ApiProperty({
    type: "integer",
    required: true,
    example: 1,
  })
  @IsInt()
  @IsNotEmpty()
  authorId: number; // ‚Üê –ù–û–í–û–ï –ü–û–õ–ï
}
```

### **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä–æ–≤:**

- **`@IsInt()`** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ
- **`@IsNotEmpty()`** - –ø–æ–ª–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è
- **`@ApiProperty()`** - –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ–ª–µ –≤ Swagger

## üîß **–®–∞–≥ 2: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è UsersService**

### **–û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–æ–¥ findOneById:**

**–ë—ã–ª–æ (–≤–æ–∑–≤—Ä–∞—â–∞–ª —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –æ–±—ä–µ–∫—Ç):**

```typescript
public findOneById(id: string) {
    return {
        id: 1234,
        firstName: "Alice",
        email: "alice@doe.com",
    };
}
```

**–°—Ç–∞–ª–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö):**

```typescript
public async findOneById(id: number): Promise<User> {
    return await this.usersRepository.findOneBy({ id });
}
```

### **–ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**

1. **`async`** - –º–µ—Ç–æ–¥ —Ç–µ–ø–µ—Ä—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
2. **`id: number`** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —á–∏—Å–ª–æ –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∏
3. **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Promise<User>`** - —Ä–µ–∞–ª—å–Ω—É—é —Å—É—â–Ω–æ—Å—Ç—å –∏–∑ –±–∞–∑—ã
4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç `findOneBy({ id })`** - –ø–æ–∏—Å–∫ –ø–æ –ø–µ—Ä–≤–∏—á–Ω–æ–º—É –∫–ª—é—á—É

## üîÑ **–®–∞–≥ 3: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è PostsService**

### **–û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–æ–¥ create:**

**–ë—ã–ª–æ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∞):**

```typescript
public async create(createPostDto: CreatePostDto) {
    let post = this.postsRepository.create({
        ...createPostDto, // –ü—Ä–æ—Å—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ–º DTO
    });
    return await this.postsRepository.save(post);
}
```

**–°—Ç–∞–ª–æ (—Å –∞–≤—Ç–æ—Ä–æ–º):**

```typescript
public async create(createPostDto: CreatePostDto) {
    // 1. –ù–∞—Ö–æ–¥–∏–º –∞–≤—Ç–æ—Ä–∞ –≤ –±–∞–∑–µ
    const author = await this.usersService.findOneById(createPostDto.authorId);

    // 2. –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç —Å –∞–≤—Ç–æ—Ä–æ–º
    let post = this.postsRepository.create({
        ...createPostDto, // –í—Å–µ –ø–æ–ª—è –∏–∑ DTO
        author,           // ‚Üê –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∞–≤—Ç–æ—Ä–∞
    });

    return await this.postsRepository.save(post);
}
```

## üéØ **–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ–¥—Ö–æ–¥**

### **–ü—Ä–∏–Ω—Ü–∏–ø –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏–∏:**

```typescript
// –ü–õ–û–•–û: –ù–∞—Ä—É—à–∞–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã –º–æ–¥—É–ª—è
@InjectRepository(User)
private userRepository: Repository<User>

// –•–û–†–û–®–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π API –º–æ–¥—É–ª—è
constructor(private usersService: UsersService)
```

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å:**

1. **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞** - –≤—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å User –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
2. **–õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –º–æ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–µ—Ä–≤–∏—Å, –∞ –Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. **–ì–∏–±–∫–æ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –º–æ–∂–µ–º –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ UsersService –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ PostsService
4. **–°–æ–±–ª—é–¥–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –º–æ–¥—É–ª–µ–π** - –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏

## üîê **–í–æ–ø—Ä–æ—Å—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–æ–º)**

### **–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:**

```typescript
// –°–µ–π—á–∞—Å –ª—é–±–æ–π –º–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å –õ–Æ–ë–û–ô authorId
authorId: 1; // –ú–æ–∂–µ—Ç —É–∫–∞–∑–∞—Ç—å —á—É–∂–æ–π ID
```

### **–ë—É–¥—É—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ:**

```typescript
// –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
@Post()
createPost(@Body() createPostDto: CreatePostDto, @CurrentUser() user: User) {
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ ID –∏–∑ DTO
    return this.postsService.create(createPostDto, user);
}
```

## üóÇÔ∏è **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

### **–¢–µ–∫—É—â–∏–µ –∏–º–ø–æ—Ä—Ç—ã (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã):**

**–í `UsersModule` (—ç–∫—Å–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–∞):**

```typescript
@Module({
  controllers: [UsersController],
  providers: [UsersService],
  exports: [UsersService], // ‚Üê –°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
})
export class UsersModule {}
```

**–í `PostsModule` (–∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è):**

```typescript
@Module({
  imports: [
    UsersModule, // ‚Üê –ú–æ–¥—É–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–µ–Ω
    // ... –¥—Ä—É–≥–∏–µ –∏–º–ø–æ—Ä—Ç—ã
  ],
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
})
export class PostsModule {}
```

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã**

### **HTTP –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:**

```http
POST http://localhost:3000/posts
Content-Type: application/json

{
  "title": "My New Post",
  "postType": "post",
  "slug": "my-new-post-with-author",
  "status": "published",
  "authorId": 1,  // ‚Üê –ù–û–í–û–ï –ü–û–õ–ï (John Doe –∏–∑ –±–∞–∑—ã)
  "metaOptions": {
    "metaValue": "{\"sidebarEnabled\": true}"
  }
}
```

### **–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**

**–î–æ –∑–∞–ø—Ä–æ—Å–∞:**

```sql
users table:
id | firstName | lastName | email
1  | John      | Doe      | john@example.com

posts table: (–ø—É—Å—Ç–æ –∏–ª–∏ –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ –ø–æ—Å—Ç—ã)
```

**–ü–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞:**

```sql
posts table:
id | title              | slug                    | authorId
4  | "My New Post"      | "my-new-post-with-author" | 1  ‚Üê –°—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ users.id=1
```

## ‚ö†Ô∏è **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ**

### **–ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:**

```typescript
// –°–µ–π—á–∞—Å: –Ω–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏
const author = await this.usersService.findOneById(createPostDto.authorId);
// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Üí author = null

// –ë—É–¥—É—â–µ–µ: –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
if (!author) {
  throw new NotFoundException(
    `User with ID ${createPostDto.authorId} not found`
  );
}
```

### **–ï—Å–ª–∏ slug –Ω–µ —É–Ω–∏–∫–∞–ª–µ–Ω:**

```typescript
// TypeORM –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É –∏–∑-–∑–∞ unique constraint
// –ù—É–∂–Ω–æ –±—É–¥–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º
```

## üîÑ **–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞ —Å –∞–≤—Ç–æ—Ä–æ–º**

### **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:**

1. **–ö–ª–∏–µ–Ω—Ç** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å —Å `authorId`
2. **PostsController** –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ CreatePostDto
3. **PostsService** –ø–æ–ª—É—á–∞–µ—Ç DTO –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `authorId`
4. **UsersService** –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –ø–æ `authorId`
5. **PostsService** —Å–æ–∑–¥–∞–µ—Ç –ø–æ—Å—Ç —Å –Ω–∞–π–¥–µ–Ω–Ω—ã–º –∞–≤—Ç–æ—Ä–æ–º
6. **TypeORM** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤—è–∑—å —á–µ—Ä–µ–∑ foreign key

### **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:**

```
Client ‚Üí PostsController ‚Üí PostsService ‚Üí UsersService ‚Üí Database
                               ‚Üì
                          PostsService ‚Üí Database (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ—Å—Ç)
```

## üí° **–ö–ª—é—á–µ–≤—ã–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã**

### **1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**

- **UsersService** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **PostsService** –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ø–æ—Å—Ç–∞–º–∏
- **–ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π API –¥—Ä—É–≥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### **2. –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**

- PostsService –Ω–µ –∑–Ω–∞–µ—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ User entity
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ User entity –Ω–µ —Å–ª–æ–º–∞—é—Ç PostsService
- –ì—Ä–∞–Ω–∏—Ü—ã –º–æ–¥—É–ª–µ–π —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã

### **3. –ü—Ä–∏–Ω—Ü–∏–ø –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:**

- UsersService –∑–Ω–∞–µ—Ç –ö–ê–ö –Ω–∞—Ö–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- PostsService –∑–Ω–∞–µ—Ç –ö–ê–ö —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã
- –ù–∏–∫—Ç–æ –Ω–µ –¥–µ–ª–∞–µ—Ç —á—É–∂—É—é —Ä–∞–±–æ—Ç—É

## üéØ **–ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã**

1. **DTO —Ä–∞—Å—à–∏—Ä–µ–Ω** –¥–ª—è –ø—Ä–∏–µ–º–∞ authorId —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
2. **UsersService —É–ª—É—á—à–µ–Ω** –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
3. **PostsService –∏—Å–ø–æ–ª—å–∑—É–µ—Ç** UsersService –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞
4. **–°–≤—è–∑—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è** —á–µ—Ä–µ–∑ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ author –æ–±—ä–µ–∫—Ç—É –ø–æ—Å—Ç–∞
5. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —É–ª—É—á—à–µ–Ω–∞** - —É–±—Ä–∞–Ω—ã –ø—Ä—è–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏
6. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –±—É–¥–µ—Ç —É–ª—É—á—à–µ–Ω–∞ –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∞–≤—Ç–æ—Ä–∞–º–∏ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö! üöÄ
