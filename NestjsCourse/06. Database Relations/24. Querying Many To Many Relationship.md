## üîç **–ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–≥–æ–≤ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å—Ç–æ–≤**

### **–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**

**HTTP GET –∑–∞–ø—Ä–æ—Å:**

```http
GET http://localhost:3000/posts
```

**–ü–æ–ª—É—á–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç (–±–µ–∑ —Ç–µ–≥–æ–≤):**

```json
[
  {
    "id": 7,
    "title": "NestJS Many-to-Many Example",
    "author": {
      "id": 1,
      "firstName": "John",
      "lastName": "Doe"
    },
    "metaOptions": {
      "id": 7,
      "metaValue": "{\"sidebarEnabled\": true}"
    },
    "tags": [] // ‚Üê –ü–£–°–¢–û! –¢–µ–≥–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
  }
]
```

## üõ†Ô∏è **–°–ø–æ—Å–æ–± 1: –Ø–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ `relations`**

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–∞ `findAll` –≤ PostsService:**

**–ë—ã–ª–æ:**

```typescript
public async findAll(userId: string) {
    let posts = await this.postsRepository.find({
        relations: {
            metaOptions: true,
            author: true,
            // tags –Ω–µ –≤–∫–ª—é—á–µ–Ω—ã!
        },
    });
    return posts;
}
```

**–°—Ç–∞–ª–æ:**

```typescript
public async findAll(userId: string) {
    let posts = await this.postsRepository.find({
        relations: {
            metaOptions: true,
            author: true,
            tags: true, // ‚Üê –î–û–ë–ê–í–õ–ï–ù–û: –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–≥–∏
        },
    });
    return posts;
}
```

### **–û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `relations`:**

```typescript
relations: {
    metaOptions: true, // One-to-One —Å–≤—è–∑—å —Å MetaOption
    author: true,      // Many-to-One —Å–≤—è–∑—å —Å User
    tags: true,        // ‚Üê Many-to-Many —Å–≤—è–∑—å —Å Tag
}
```

**–í–∞–∂–Ω–æ:** –ò–º—è `tags` –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∏–º–µ–Ω–µ–º —Å–≤–æ–π—Å—Ç–≤–∞ –≤ `Post.entity.ts`:

```typescript
// –í Post.entity.ts
@ManyToMany(() => Tag)
@JoinTable()
tags?: Tag[]; // ‚Üê –∏–º–µ–Ω–Ω–æ —ç—Ç–æ –∏–º—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ relations
```

## üîÑ **–°–ø–æ—Å–æ–± 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ `eager: true`**

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –≤ Post.entity.ts:**

**–ë—ã–ª–æ:**

```typescript
@ManyToMany(() => Tag)
@JoinTable()
tags?: Tag[];
```

**–°—Ç–∞–ª–æ:**

```typescript
@ManyToMany(() => Tag, {
    eager: true // ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –ª—é–±–æ–º –∑–∞–ø—Ä–æ—Å–µ
})
@JoinTable()
tags?: Tag[];
```

### **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `eager: true`:**

- –¢–µ–≥–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** –ø—Ä–∏ –õ–Æ–ë–û–ú –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å—Ç–æ–≤
- –ù–µ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `relations: ['tags']` –≤ —Å–µ—Ä–≤–∏—Å–µ
- –†–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `find()`, `findOne()`, `findBy()`, etc.

## üß™ **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π**

### **–ü–æ—Å–ª–µ –ª—é–±–æ–≥–æ –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:**

**HTTP GET –∑–∞–ø—Ä–æ—Å:**

```http
GET http://localhost:3000/posts
```

**–û—Ç–≤–µ—Ç (—Å —Ç–µ–≥–∞–º–∏):**

```json
[
  {
    "id": 7,
    "title": "NestJS Many-to-Many Example",
    "author": {
      "id": 1,
      "firstName": "John",
      "lastName": "Doe"
    },
    "metaOptions": {
      "id": 7,
      "metaValue": "{\"sidebarEnabled\": true}"
    },
    "tags": [
      // ‚Üê –¢–ï–ü–ï–†–¨ –ó–ê–ì–†–£–ñ–ï–ù–´!
      {
        "id": 1,
        "name": "JavaScript",
        "slug": "javascript",
        "description": "All posts about JavaScript",
        "createDate": "2024-01-15T10:30:00.000Z",
        "updateDate": "2024-01-15T10:30:00.000Z"
      }
    ]
  }
]
```

## üìä **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö –ø–æ–¥—Ö–æ–¥–æ–≤**

### **–ß–µ—Ä–µ–∑ `relations` –≤ —Å–µ—Ä–≤–∏—Å–µ:**

```typescript
// PostsService - –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å
public async findAll(includeTags: boolean) {
    return this.postsRepository.find({
        relations: includeTags ? { tags: true } : {}
        // –†–µ—à–∞–µ–º –∫–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–µ–≥–∏
    });
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - —Ä–µ—à–∞–µ–º –≤ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ –∫–æ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∏–∑–±–µ–≥–∞–µ–º –ª–∏—à–Ω–∏—Ö JOIN –∫–æ–≥–¥–∞ —Ç–µ–≥–∏ –Ω–µ –Ω—É–∂–Ω—ã
- ‚úÖ **–Ø–≤–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** - –ø–æ–Ω—è—Ç–Ω–æ —á—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∫–æ–¥–∞

### **–ß–µ—Ä–µ–∑ `eager: true` –≤ entity:**

```typescript
// Post.entity - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–≥–¥–∞
@ManyToMany(() => Tag, { eager: true })
@JoinTable()
tags?: Tag[];
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- ‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ** - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å relations
- ‚úÖ **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å** - —Ç–µ–≥–∏ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –º–µ–Ω—å—à–µ –∫–æ–¥–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö

## ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ SQL –∑–∞–ø—Ä–æ—Å—ã**

### **–° `relations` –≤ —Å–µ—Ä–≤–∏—Å–µ:**

```sql
-- –ö–æ–≥–¥–∞ –ù–ï —É–∫–∞–∑—ã–≤–∞–µ–º tags –≤ relations:
SELECT * FROM post;
-- –ë—ã—Å—Ç—Ä–æ, –±–µ–∑ –ª–∏—à–Ω–∏—Ö JOIN

-- –ö–æ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ–º tags –≤ relations:
SELECT post.*, tags.*
FROM post
LEFT JOIN post_tags_tag ON post.id = post_tags_tag."postId"
LEFT JOIN tag ON post_tags_tag."tagId" = tag.id;
-- –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–≥–∏
```

### **–° `eager: true`:**

```sql
-- –í–°–ï–ì–î–ê –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è JOIN:
SELECT post.*, tags.*
FROM post
LEFT JOIN post_tags_tag ON post.id = post_tags_tag."postId"
LEFT JOIN tag ON post_tags_tag."tagId" = tag.id;
-- –í—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º —Ç–µ–≥–∏, –Ω–æ –≤—Å–µ–≥–¥–∞ JOIN
```

## üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤—ã–±–æ—Ä—É –ø–æ–¥—Ö–æ–¥–∞**

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `relations` –∫–æ–≥–¥–∞:**

- **API –∏–º–µ–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏** (—Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ vs –¥–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
- **–ë–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö** - –Ω—É–∂–Ω–æ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
- **–¢–µ–≥–∏ –Ω–µ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã** –≤ –æ—Ç–≤–µ—Ç–µ
- **–í–∞–∂–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**

### **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `eager: true` –∫–æ–≥–¥–∞:**

- **–¢–µ–≥–∏ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–Ω—ã** –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –ø–æ—Å—Ç–æ–≤
- **–ù–µ–±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–∞
- **–£–¥–æ–±—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** –≤–∞–∂–Ω–µ–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **–ü—Ä–æ—Ç–æ—Ç–∏–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**

## üîß **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∞–≤—Ç–æ—Ä–∞**

### **–í –∫–æ–¥–µ –∞–≤—Ç–æ—Ä–∞:**

```typescript
// –°–ø–æ—Å–æ–± 1: relations –≤ —Å–µ—Ä–≤–∏—Å–µ (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞)
public async findAll(userId: string) {
    let posts = await this.postsRepository.find({
        relations: {
            metaOptions: true,
            author: true,
            // tags: true, // ‚Üê –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —è–≤–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
        },
    });
    return posts;
}

// –°–ø–æ—Å–æ–± 2: eager –≤ entity (–∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
@ManyToMany(() => Tag, { eager: true }) // ‚Üê –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
@JoinTable()
tags?: Tag[];
```

### **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã:**

1. **–°–Ω–∞—á–∞–ª–∞** –ø–æ–∫–∞–∑–∞–Ω —Å–ø–æ—Å–æ–± —Å `relations` - —Ç–µ–≥–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
2. **–ó–∞—Ç–µ–º** –ø–µ—Ä–µ–∫–ª—é—á–∏–ª–∏—Å—å –Ω–∞ `eager: true` - —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
3. **–û–±–∞ —Å–ø–æ—Å–æ–±–∞** –¥–∞—é—Ç –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ HTTP –æ—Ç–≤–µ—Ç–µ

## ‚ö†Ô∏è **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –æ `eager: true`**

### **–ü—Ä–æ–±–ª–µ–º–∞ —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

```typescript
// –ï—Å–ª–∏ –≤ Tag —Ç–æ–∂–µ –¥–æ–±–∞–≤–∏—Ç—å eager: true –æ–±—Ä–∞—Ç–Ω–æ –∫ Post
@ManyToMany(() => Post, { eager: true })
posts: Post[];

// –ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π —Ä–µ–∫—É—Ä—Å–∏–∏ –≤ JSON!
```

### **–ü—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

```typescript
// –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–≥–∏, –¥–∞–∂–µ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞
// –õ–∏—à–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –ø–æ —Å–µ—Ç–∏
// –õ–∏—à–Ω—è—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
```

## üí° **–õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –∏–∑ —É—Ä–æ–∫–∞**

### **1. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∏–º–µ–Ω:**

```typescript
// Entity property name ‚Üí relations key
tags?: Tag[]; // –≤ entity
relations: { tags: true } // –≤ —Å–µ—Ä–≤–∏—Å–µ - –î–û–õ–ñ–ù–û –°–û–í–ü–ê–î–ê–¢–¨!
```

### **2. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è:**

```typescript
// –•–æ—Ä–æ—à–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è eager
@ManyToMany(() => Tag, {
    eager: true // –í–Ω–∏–º–∞–Ω–∏–µ: –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–≥–∏!
})
@JoinTable()
tags?: Tag[];
```

### **3. –ì–∏–±–∫–∏–µ API:**

```typescript
// –ú–æ–∂–Ω–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—ã
public async findPosts(includeTags: boolean = false) {
    return this.postsRepository.find({
        relations: includeTags ? { tags: true } : {}
        // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ç–µ–≥–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è, –Ω–æ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å
    });
}
```

## üéì **–ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã**

1. **Many-to-Many –æ—Ç–Ω–æ—à–µ–Ω–∏—è** –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Ç–∞–∫ –∂–µ –∫–∞–∫ One-to-Many –∏ One-to-One
2. **`relations` –ø–∞—Ä–∞–º–µ—Ç—Ä** - –≥–∏–±–∫–∏–π —Å–ø–æ—Å–æ–± –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É —Å–≤—è–∑–µ–π
3. **`eager: true`** - —É–¥–æ–±–Ω—ã–π —Å–ø–æ—Å–æ–± –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
4. **–ò–º–µ–Ω–∞ –≤ relations** –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∏–º–µ–Ω–∞–º–∏ —Å–≤–æ–π—Å—Ç–≤ –≤ entity
5. **–í—ã–±–æ—Ä –ø–æ–¥—Ö–æ–¥–∞** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫ –≥–∏–±–∫–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–æ—Å—Ç–æ–≤ –º—ã –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ–º–∏ —Å–≤—è–∑—è–º–∏, –≤–∫–ª—é—á–∞—è —Ç–µ–≥–∏! üöÄ
