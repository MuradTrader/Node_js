## üèóÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞**

### **–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**

- **Post** - –≤–ª–∞–¥–µ–ª–µ—Ü –æ—Ç–Ω–æ—à–µ–Ω–∏—è (–∏–º–µ–µ—Ç `@JoinTable()`)
- **Tag** - –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü (–Ω–µ—Ç `@JoinTable()`)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Tag –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ foreign key constraint

## üîß **–°–æ–∑–¥–∞–Ω–∏–µ –º–µ—Ç–æ–¥–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤ TagService**

### **–ú–µ—Ç–æ–¥ delete –≤ TagsService:**

```typescript
public async delete(id: number) {
    await this.tagsRepository.delete(id);
    return { deleted: true, id };
}
```

### **–ú–µ—Ç–æ–¥ delete –≤ TagsController:**

```typescript
@Delete()
public delete(@Query("id", ParseIntPipe) id: number) {
    return this.tagsService.delete(id);
}
```

## üö® **–ü—Ä–æ–±–ª–µ–º–∞: Foreign Key Constraint Violation**

### **–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞:**

```sql
ERROR: update or delete on table "tag" violates foreign key constraint
"FK_xxxxxxxx" on table "post_tags_tag"
```

### **–ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:**

**Junction table constraints:**

```sql
-- post_tags_tag –∏–º–µ–µ—Ç –¥–≤–∞ foreign key:
-- "postId" integer REFERENCES post(id) ON DELETE CASCADE
-- "tagId" integer REFERENCES tag(id) -- ‚Üê –ù–ï–¢ ON DELETE CASCADE!
```

**–õ–æ–≥–∏–∫–∞:**

- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ **Post** ‚Üí —Å–≤—è–∑–∏ —É–¥–∞–ª—è—é—Ç—Å—è (–±–ª–∞–≥–æ–¥–∞—Ä—è `ON DELETE CASCADE`)
- –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ **Tag** ‚Üí —Å–≤—è–∑–∏ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è (–Ω–µ—Ç `ON DELETE CASCADE`)

## üõ†Ô∏è **–†–µ—à–µ–Ω–∏–µ: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `onDelete: 'CASCADE'`**

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Tag.entity.ts:**

```typescript
// –ë–´–õ–û:
@ManyToMany(() => Post, post => post.tags)
posts: Post[];

// –°–¢–ê–õ–û:
@ManyToMany(() => Post, post => post.tags, {
    onDelete: 'CASCADE' // ‚Üê –ö–ª—é—á–µ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ!
})
posts: Post[];
```

## ‚öôÔ∏è **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç `onDelete: 'CASCADE'`**

### **–ù–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**

```sql
-- TypeORM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç foreign key constraint:
ALTER TABLE post_tags_tag
DROP CONSTRAINT "FK_tag_id";

ALTER TABLE post_tags_tag
ADD CONSTRAINT "FK_tag_id"
FOREIGN KEY ("tagId") REFERENCES tag(id)
ON DELETE CASCADE; -- ‚Üê –¢–µ–ø–µ—Ä—å —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–µ–≥–∞
```

### **–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**

**–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ Tag:**

```sql
-- 1. –£–¥–∞–ª—è–µ–º —Ç–µ–≥
DELETE FROM tag WHERE id = 2;

-- 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ —Å–≤—è–∑–∏ —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º
DELETE FROM post_tags_tag WHERE "tagId" = 2;
```

## üß™ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è**

### **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**

**–°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç—ã —Å —Ç–µ–≥–∞–º–∏:**

```http
POST http://localhost:3000/posts
Content-Type: application/json

{
  "title": "Post with JavaScript and TypeScript",
  "postType": "post",
  "slug": "post-with-both-tags",
  "status": "published",
  "authorId": 1,
  "tags": [1, 2]  // JavaScript (1) + TypeScript (2)
}
```

### **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ PgAdmin:**

**–î–æ —É–¥–∞–ª–µ–Ω–∏—è:**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ tags:
id | name        | slug
1  | JavaScript  | javascript
2  | TypeScript  | typescript

-- Junction table post_tags_tag:
postId | tagId
8      | 1
8      | 2
9      | 1
9      | 2
```

### **HTTP –∑–∞–ø—Ä–æ—Å —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–≥–∞:**

```http
DELETE http://localhost:3000/tags?id=2
```

### **–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ tags (TypeScript —É–¥–∞–ª–µ–Ω):
id | name        | slug
1  | JavaScript  | javascript

-- Junction table (—Å–≤—è–∑–∏ —Å TypeScript —É–¥–∞–ª–µ–Ω—ã):
postId | tagId
8      | 1
9      | 1
```

## üîÑ **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è**

### **–£–¥–∞–ª–µ–Ω–∏–µ Post (–≤–ª–∞–¥–µ–ª–µ—Ü):**

```typescript
// –†–∞–±–æ—Ç–∞–µ—Ç –ë–ï–ó –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
await this.postsRepository.delete(8);
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∏ –∏–∑ junction table
```

### **–£–¥–∞–ª–µ–Ω–∏–µ Tag (–Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü):**

```typescript
// –¢—Ä–µ–±—É–µ—Ç `onDelete: 'CASCADE'`
await this.tagsRepository.delete(2);
// –ë–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –æ—à–∏–±–∫–∞, —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π ‚Üí —É–¥–∞–ª—è–µ—Ç —Å–≤—è–∑–∏
```

## üéØ **–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –∫–∞—Å–∫–∞–¥–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è**

### **–ü—Ä–∞–≤–∏–ª–æ:**

> "–ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ-–≤–ª–∞–¥–µ–ª—å—Ü–µ, –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —è–≤–Ω–æ —á–µ—Ä–µ–∑ `onDelete: 'CASCADE'` –Ω–∞ –Ω–µ-–≤–ª–∞–¥–µ—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω–µ"

### **–í –Ω–∞—à–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:**

- **Post** - –≤–ª–∞–¥–µ–ª–µ—Ü ‚Üí –∫–∞—Å–∫–∞–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **Tag** - –Ω–µ –≤–ª–∞–¥–µ–ª–µ—Ü ‚Üí —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `onDelete: 'CASCADE'`

## üí° **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è**

### **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ `onDelete: 'CASCADE'`:**

```typescript
// –£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞ - –Ω–µ –Ω—É–∂–Ω–æ —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–≤—è–∑—è–º–∏
public async delete(id: number) {
    await this.tagsRepository.delete(id); // –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    return { deleted: true, id };
}
```

### **–ë–µ–∑ `onDelete: 'CASCADE'` –ø—Ä–∏—à–ª–æ—Å—å –±—ã:**

```typescript
public async delete(id: number) {
    // 1. –ù–∞–π—Ç–∏ –≤—Å–µ –ø–æ—Å—Ç—ã —Å —ç—Ç–∏–º —Ç–µ–≥–æ–º
    const posts = await this.postsRepository.find({
        where: { tags: { id } },
        relations: ['tags']
    });

    // 2. –£–±—Ä–∞—Ç—å —Ç–µ–≥ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Å—Ç–∞
    for (const post of posts) {
        post.tags = post.tags.filter(tag => tag.id !== id);
        await this.postsRepository.save(post);
    }

    // 3. –£–¥–∞–ª–∏—Ç—å —Ç–µ–≥
    await this.tagsRepository.delete(id);
    return { deleted: true, id };
}
```

## ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è**

### **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:**

- `onDelete: 'CASCADE'` –º–æ–∂–µ—Ç –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ —É–¥–∞–ª–∏—Ç—å –º–Ω–æ–≥–æ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º —Å–≤—è–∑–µ–π
- –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î, –º–∏–Ω—É—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:**

```typescript
// 1. Soft Delete (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ) - –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ
@DeleteDateColumn()
deletedAt: Date;

// 2. –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏ - –±–æ–ª—å—à–µ –∫–æ–Ω—Ç—Ä–æ–ª—è
// 3. ON DELETE SET NULL - –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–≤—è–∑–∏ –Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç NULL
```

## üîß **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ TypeORM**

### **–ì–¥–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `onDelete`:**

```typescript
// Many-to-Many (–Ω–µ –≤–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞)
@ManyToMany(() => Post, post => post.tags, { onDelete: 'CASCADE' })

// Many-to-One / One-to-Many
@ManyToOne(() => User, { onDelete: 'CASCADE' })
@OneToMany(() => Post, post => post.author, { onDelete: 'CASCADE' })

// One-to-One
@OneToOne(() => MetaOption, { onDelete: 'CASCADE' })
```

### **–î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏:**

```typescript
onDelete: "CASCADE"; // –£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
onDelete: "SET NULL"; // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å NULL –≤ foreign key
onDelete: "RESTRICT"; // –ó–∞–ø—Ä–µ—Ç–∏—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–≤—è–∑–∏
onDelete: "NO ACTION"; // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ RESTRICT
```

## üéØ **–ò—Ç–æ–≥–æ–≤—ã–µ –≤—ã–≤–æ–¥—ã**

1. **–í–ª–∞–¥–µ–ª–µ—Ü –æ—Ç–Ω–æ—à–µ–Ω–∏—è** (`@JoinTable`) –∏–º–µ–µ—Ç –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
2. **–ù–µ-–≤–ª–∞–¥–µ—é—â–∞—è —Å—Ç–æ—Ä–æ–Ω–∞** —Ç—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `onDelete: 'CASCADE'`
3. **`onDelete: 'CASCADE'`** –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
4. **–ë–µ–∑ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ-–≤–ª–∞–¥–µ—é—â–µ–π —Å—É—â–Ω–æ—Å—Ç–∏ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É foreign key constraint
5. **Junction table** —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

–¢–µ–ø–µ—Ä—å –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–ª—è –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω bidirectional Many-to-Many –æ—Ç–Ω–æ—à–µ–Ω–∏—è! üöÄ
