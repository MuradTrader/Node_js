## üì¶ –ß—Ç–æ —Ç–∞–∫–æ–µ –±—É—Ñ–µ—Ä—ã –≤ Node.js?

**Buffer** ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å –≤ Node.js, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∏–Ω–∞—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ (–±–∞–π—Ç–∞–º–∏). –≠—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ñ–∞–π–ª–∞–º–∏, —Å–µ—Ç–µ–≤—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏, –ø–æ—Ç–æ–∫–∞–º–∏ –∏ —Ç.–¥.

---

## üîß –¢—Ä–∏ —Å–ø–æ—Å–æ–±–∞ –≤—ã–¥–µ–ª–µ–Ω–∏—è –±—É—Ñ–µ—Ä–æ–≤

### 1. `Buffer.alloc(size, fill = 0)`

```js
const buffer = Buffer.alloc(10000);
```

- üìå **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç?**

  - –í—ã–¥–µ–ª—è–µ—Ç –±–ª–æ–∫ –ø–∞–º—è—Ç–∏ —Ä–∞–∑–º–µ—Ä–æ–º `size` –±–∞–π—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10,000 –±–∞–π—Ç).
  - **–ó–∞–ø–æ–ª–Ω—è–µ—Ç** –∫–∞–∂–¥—ã–π –±–∞–π—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º `fill` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `0`).

- üìå **–ó–∞—á–µ–º?**

  - –ß—Ç–æ–±—ã –±—ã—Ç—å —É–≤–µ—Ä–µ–Ω–Ω—ã–º, —á—Ç–æ –≤—Å–µ –±–∞–π—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —É—Ç–µ—á–∫–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).

- üìå **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:**

  - ‚ö†Ô∏è –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –Ω—É–ª—è–º–∏ —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ ‚Äî –∫–∞–∂–¥—ã–π –±–∞–π—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é.

---

### 2. `Buffer.allocUnsafe(size)`

```js
const unsafeBuffer = Buffer.allocUnsafe(10000);
```

- üìå **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç?**

  - –í—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –Ω—É–∂–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, **–Ω–µ –∑–∞–ø–æ–ª–Ω—è—è –µ—ë**.
  - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–∂–µ—Ç –±—ã—Ç—å **"–º—É—Å–æ—Ä–æ–º" –∏–∑ –ø–∞–º—è—Ç–∏** (–¥–∞–Ω–Ω—ã–µ, —Ä–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–≤—à–∏–µ—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–æ–π, —Å–∏—Å—Ç–µ–º–æ–π –∏ —Ç.–¥.).

- üìå **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

  - ‚úÖ **–ë—ã—Å—Ç—Ä–æ** ‚Äî –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—Å—è –≤—Ä–µ–º—è –Ω–∞ –æ—á–∏—Å—Ç–∫—É.
  - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—É–ª –±—É—Ñ–µ—Ä–æ–≤** (–æ–± —ç—Ç–æ–º –Ω–∏–∂–µ).

- ‚ö†Ô∏è **–û–ø–∞—Å–Ω–æ—Å—Ç—å:**

  - –í –ø–∞–º—è—Ç–∏ –º–æ–≥—É—Ç –±—ã—Ç—å **—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã).
  - –ï—Å–ª–∏ –Ω–µ –æ—á–∏—Å—Ç–∏—Ç—å –±—É—Ñ–µ—Ä –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ‚Äî –º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏–ª–∏ —Ö–∞–∫–µ—Ä –º–æ–∂–µ—Ç –∏—Ö –ø–æ–ª—É—á–∏—Ç—å.

- üõ°Ô∏è **–ß—Ç–æ –¥–µ–ª–∞—Ç—å?**

  - –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `allocUnsafe`, —Å—Ä–∞–∑—É –∑–∞–ø–æ–ª–Ω–∏ –±—É—Ñ–µ—Ä:

    ```js
    unsafeBuffer.fill(0);
    ```

---

### 3. `Buffer.allocUnsafeSlow(size)`

```js
const slowBuffer = Buffer.allocUnsafeSlow(10000);
```

- üìå **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç?**

  - –¢–æ –∂–µ, —á—Ç–æ –∏ `allocUnsafe`, –Ω–æ **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –±—É—Ñ–µ—Ä–Ω—ã–π –ø—É–ª Node.js**.
  - –ü—Ä–æ—Å—Ç–æ –≤—ã–¥–µ–ª—è–µ—Ç –Ω–æ–≤—ã–π —É—á–∞—Å—Ç–æ–∫ –ø–∞–º—è—Ç–∏.

- üìå **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?**

  - –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±—É—Ñ–µ—Ä **–Ω–∞–¥–æ–ª–≥–æ** –∏ **–Ω–µ —Ö–æ—á–µ—à—å –∑–∞–Ω–∏–º–∞—Ç—å** –æ–±—â–∏–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –ø—É–ª, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥—Ä—É–≥–∏–º–∏ –±—É—Ñ–µ—Ä–∞–º–∏.
  - –ß—Ç–æ–±—ã –Ω–µ –º–µ—à–∞—Ç—å –¥–∞–ª—å–Ω–µ–π—à–∏–º –≤—ã–¥–µ–ª–µ–Ω–∏—è–º –≤ –ø—É–ª–µ.

---

## ‚öôÔ∏è –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã `allocUnsafe`

–ò–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ:

```js
const unsafeBuffer = Buffer.allocUnsafe(10000);
for (let i = 0; i < unsafeBuffer.length; i++) {
  if (unsafeBuffer[i] !== 0) {
    console.log(`Element at ${i} has value: ${unsafeBuffer[i].toString(2)}`);
  }
}
```

- –í—ã–≤–æ–¥–∏—Ç —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ä–∞–≤–Ω—ã `0` (–∑–Ω–∞—á–∏—Ç –≤ –ø–∞–º—è—Ç–∏ –±—ã–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ).
- –ú–µ—Ç–æ–¥ `toString(2)` ‚Äî –ø–µ—Ä–µ–≤–æ–¥ –≤ **–¥–≤–æ–∏—á–Ω—É—é —Å–∏—Å—Ç–µ–º—É** (–æ—Å–Ω–æ–≤–∞–Ω–∏–µ 2).
- –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ —Ä–µ–∞–ª—å–Ω–æ –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ –±–∞–π—Ç—ã (–æ—Å—Ç–∞—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ø–∞–º—è—Ç–∏).

---

## üí° –ü–æ—á–µ–º—É `allocUnsafe` –±—ã—Å—Ç—Ä–µ–µ?

### –ü—Ä–∏—á–∏–Ω–∞ 1: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

- `alloc` = –≤—ã–¥–µ–ª–µ–Ω–∏–µ + –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω—É–ª—è–º–∏ (–º–µ–¥–ª–µ–Ω–Ω–æ)
- `allocUnsafe` = —Ç–æ–ª—å–∫–æ –≤—ã–¥–µ–ª–µ–Ω–∏–µ (–±—ã—Å—Ç—Ä–æ)

---

### –ü—Ä–∏—á–∏–Ω–∞ 2: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **–≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø—É–ª–∞ –±—É—Ñ–µ—Ä–æ–≤** Node.js

- üìå Node.js –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª—è–µ—Ç –∫—É—Å–æ–∫ –ø–∞–º—è—Ç–∏ (–Ω–∞–ø—Ä. \~8 KB), –Ω–∞–∑—ã–≤–∞–µ–º—ã–π **Buffer Pool**.
- –ö–æ–≥–¥–∞ —Ç—ã —Å–æ–∑–¥–∞—ë—à—å –º–∞–ª–µ–Ω—å–∫–∏–π –±—É—Ñ–µ—Ä (–º–µ–Ω—å—à–µ –ø–æ–ª–æ–≤–∏–Ω—ã –ø—É–ª–∞), Node –ø—Ä–æ—Å—Ç–æ "–æ—Ç—Ä–µ–∑–∞–µ—Ç –∫—É—Å–æ–∫" –∏–∑ —É–∂–µ –≥–æ—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫–∞.
- –≠—Ç–æ **—Å–∏–ª—å–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç** —Ä–∞–±–æ—Ç—É, —Ç.–∫. –Ω–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –û–°.

#### –ö–∞–∫–æ–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–Ω–æ–≥–æ –ø—É–ª–∞?

```js
console.log(Buffer.poolSize); // –û–±—ã—á–Ω–æ 8192 (8 KB = 8 √ó 1024 –±–∞–π—Ç)
```

- –ï—Å–ª–∏ —Å–æ–∑–¥–∞—Ç—å –±—É—Ñ–µ—Ä —Å —Ä–∞–∑–º–µ—Ä–æ–º **< Math.floor(Buffer.poolSize / 2)**, —Ç–æ Node –æ—Ç–¥–∞—Å—Ç —á–∞—Å—Ç—å –∏–∑ –ø—É–ª–∞ (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ).

---

### üìâ –ü–æ–±–∏—Ç–æ–≤—ã–π —Å–¥–≤–∏–≥: `>>` –∏ `>>>`

–í –∫–æ–¥–µ –º–æ–∂–Ω–æ –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å:

```js
Buffer.poolSize >> 1;
```

- –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç **"—Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –¥–≤–∞ –∏ –≤–∑—è—Ç—å —Ü–µ–ª—É—é —á–∞—Å—Ç—å"**.
- –≠—Ç–æ **–ø–æ–±–∏—Ç–æ–≤—ã–π —Å–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ**:

  - `x >> 1` = `Math.floor(x / 2)`

- –û—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± –¥–µ–ª–µ–Ω–∏—è –Ω–∞ 2 –≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ.

---

## ‚úÖ –ú–µ—Ç–æ–¥—ã `Buffer.from()` –∏ `Buffer.concat()`

- –û–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **`allocUnsafe`** –≤–Ω—É—Ç—Ä–∏ —Å–µ–±—è, –Ω–æ –¥–µ–ª–∞—é—Ç —ç—Ç–æ **–±–µ–∑–æ–ø–∞—Å–Ω–æ**, –ø–æ—Ç–æ–º—É —á—Ç–æ:

  - **—Å—Ä–∞–∑—É –∑–∞–ø–æ–ª–Ω—è—é—Ç** –±—É—Ñ–µ—Ä –Ω—É–∂–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
  - –Ω–µ –æ—Å—Ç–∞–≤–ª—è—é—Ç –º—É—Å–æ—Ä–∞.

```js
const buf = Buffer.from("hello"); // –±–µ–∑–æ–ø–∞—Å–Ω–æ
const combined = Buffer.concat([buf1, buf2]); // –±–µ–∑–æ–ø–∞—Å–Ω–æ
```

---

## ‚ùó–†–∏—Å–∫–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å `allocUnsafe`**:

  - –°—Ä–∞–∑—É **–æ—á–∏—â–∞–π –±—É—Ñ–µ—Ä**: `buf.fill(0)`
  - **–ù–µ –≤—Å—Ç–∞–≤–ª—è–π —Ç—É–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ** –¥–æ –æ—á–∏—Å—Ç–∫–∏
  - ‚ö†Ô∏è **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–π –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π `unsafeBuffer` –∫–ª–∏–µ–Ω—Ç—É** ‚Äî —ç—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Ç–µ—á–∫–æ–π –¥–∞–Ω–Ω—ã—Ö

- **–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–æ —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é** ‚Äî –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `Buffer.alloc()`

---

## üß† –ü–æ–¥ –∫–∞–ø–æ—Ç–æ–º: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –±–∏—Ç–æ–≤—ã–µ —Å–¥–≤–∏–≥–∏?

–°–¥–≤–∏–≥ –≤–ø—Ä–∞–≤–æ:

```
60        = 0011 1100 (binary)
60 >> 1   = 0001 1110 = 30
30 >> 1   = 0000 1111 = 15
15 >> 1   = 0000 0111 = 7
```

- –ö–∞–∂–¥—ã–π —Å–¥–≤–∏–≥ ‚Äî –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ 2 —Å –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ–º –¥—Ä–æ–±–Ω–æ–π —á–∞—Å—Ç–∏.
- CPU –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –∑–∞ 1-2 —Ç–∞–∫—Ç–∞ (–æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ).

---

## üßæ –†–µ–∑—é–º–µ

| –ú–µ—Ç–æ–¥                          | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è  | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É–ª              | –ë—ã—Å—Ç—Ä–æ—Ç–∞    | –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å |
| ------------------------------ | -------------- | --------------------------- | ----------- | ------------ |
| `Buffer.alloc(size)`           | ‚úÖ (–Ω—É–ª–µ–≤—ã–º–∏)  | ‚ùå                          | üê¢ –ú–µ–¥–ª–µ–Ω–Ω–æ | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Buffer.allocUnsafe(size)`     | ‚ùå             | ‚úÖ (–µ—Å–ª–∏ size < poolSize/2) | ‚ö° –ë—ã—Å—Ç—Ä–æ   | ‚ö†Ô∏è –û–ø–∞—Å–Ω–æ    |
| `Buffer.allocUnsafeSlow(size)` | ‚ùå             | ‚ùå                          | ‚ö†Ô∏è –ú–µ–¥–ª–µ–Ω–Ω–æ | ‚ö†Ô∏è –û–ø–∞—Å–Ω–æ    |
| `Buffer.from()`                | ‚úÖ (—Å –¥–∞–Ω–Ω—ã–º–∏) | ‚úÖ                          | ‚ö° –ë—ã—Å—Ç—Ä–æ   | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |
| `Buffer.concat()`              | ‚úÖ (—Å –¥–∞–Ω–Ω—ã–º–∏) | ‚úÖ                          | ‚ö° –ë—ã—Å—Ç—Ä–æ   | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ |

---
